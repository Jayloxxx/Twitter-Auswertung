<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twitter TER Dashboard - Professionelle Analyse</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Chart.js f√ºr Visualisierungen -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- Alpine.js f√ºr Interaktivit√§t -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <!-- Tailwind Konfiguration -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        twitter: '#1DA1F2',
                        primary: '#3B82F6',
                        success: '#10B981',
                        warning: '#F59E0B',
                        danger: '#EF4444'
                    }
                }
            }
        }
    </script>

    <style>
        [x-cloak] { display: none !important; }

        /* Smooth Scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }

        /* Card Hover Effects */
        .card-hover {
            transition: all 0.3s ease;
        }

        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-900" x-data="dashboardApp()" x-init="init()">

    <!-- Header -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <svg class="w-10 h-10 text-twitter" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
                    </svg>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900">Twitter TER Dashboard</h1>
                        <p class="text-sm text-gray-500">Twitter Engagement Rate nach Hirsch 2025</p>
                    </div>
                </div>

                <!-- Session Selector -->
                <div class="flex items-center space-x-3">
                    <!-- Active Session Display + Dropdown -->
                    <div class="relative" x-data="{ open: false }" @click.away="open = false">
                        <button @click="open = !open"
                                class="flex items-center space-x-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors">
                            <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/>
                            </svg>
                            <span class="font-medium text-gray-900" x-text="activeSession ? activeSession.name : 'Keine Session'"></span>
                            <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                            </svg>
                        </button>

                        <!-- Dropdown Menu -->
                        <div x-show="open"
                             x-transition:enter="transition ease-out duration-100"
                             x-transition:enter-start="transform opacity-0 scale-95"
                             x-transition:enter-end="transform opacity-100 scale-100"
                             x-transition:leave="transition ease-in duration-75"
                             x-transition:leave-start="transform opacity-100 scale-100"
                             x-transition:leave-end="transform opacity-0 scale-95"
                             class="absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-xl border border-gray-200 z-50"
                             style="display: none;">

                            <div class="p-3 border-b border-gray-200">
                                <div class="text-xs font-semibold text-gray-500 uppercase">Analysesitzungen</div>
                            </div>

                            <!-- Session List -->
                            <div class="max-h-64 overflow-y-auto">
                                <template x-for="session in sessions" :key="session.id">
                                    <div class="px-3 py-2 hover:bg-gray-50 cursor-pointer flex items-center justify-between group"
                                         :class="activeSession && activeSession.id === session.id ? 'bg-blue-50' : ''">
                                        <div @click="switchSession(session.id); open = false" class="flex-1">
                                            <div class="flex items-center space-x-2">
                                                <span class="font-medium text-gray-900" x-text="session.name"></span>
                                                <span x-show="activeSession && activeSession.id === session.id"
                                                      class="px-2 py-0.5 bg-blue-500 text-white text-xs rounded-full">
                                                    Aktiv
                                                </span>
                                            </div>
                                            <div class="text-xs text-gray-500 mt-1" x-text="session.description || 'Keine Beschreibung'"></div>
                                            <div class="text-xs text-gray-400 mt-1">
                                                <span x-text="session.post_count || 0"></span> Posts
                                            </div>
                                        </div>
                                        <button @click.stop="deleteSession(session.id, session.name)"
                                                x-show="!(activeSession && activeSession.id === session.id)"
                                                class="opacity-0 group-hover:opacity-100 p-1 text-red-500 hover:bg-red-50 rounded transition-opacity">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                            </svg>
                                        </button>
                                    </div>
                                </template>

                                <div x-show="sessions.length === 0" class="px-3 py-8 text-center text-gray-400 text-sm">
                                    Keine Sessions vorhanden
                                </div>
                            </div>

                            <!-- New Session Button -->
                            <div class="p-3 border-t border-gray-200">
                                <button @click="openSessionDialog('create'); open = false"
                                        class="w-full px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors flex items-center justify-center space-x-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                    </svg>
                                    <span>Neue Session erstellen</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Manage Sessions Button -->
                    <button @click="openSessionDialog('manage')"
                            class="p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors"
                            title="Sessions verwalten">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                    </button>
                </div>

                <!-- Stats Header -->
                <div class="hidden md:flex items-center space-x-6">
                    <div class="text-center">
                        <div class="text-2xl font-bold text-primary" x-text="stats.total_posts || 0"></div>
                        <div class="text-xs text-gray-500">Posts</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-success" x-text="stats.reviewed_posts || 0"></div>
                        <div class="text-xs text-gray-500">Reviewed</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-warning" x-text="stats.unreviewed_posts || 0"></div>
                        <div class="text-xs text-gray-500">Unreviewed</div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Notification Container (Fixed Position) -->
    <div class="fixed top-4 right-4 z-50 space-y-2" style="max-width: 400px;">
        <template x-for="notification in notifications" :key="notification.id">
            <div x-show="true"
                 x-transition:enter="transform ease-out duration-300 transition"
                 x-transition:enter-start="translate-x-full opacity-0"
                 x-transition:enter-end="translate-x-0 opacity-100"
                 x-transition:leave="transform ease-in duration-200 transition"
                 x-transition:leave-start="translate-x-0 opacity-100"
                 x-transition:leave-end="translate-x-full opacity-0"
                 :class="{
                     'bg-green-50 border-green-500 text-green-800': notification.type === 'success',
                     'bg-red-50 border-red-500 text-red-800': notification.type === 'error',
                     'bg-blue-50 border-blue-500 text-blue-800': notification.type === 'info',
                     'bg-yellow-50 border-yellow-500 text-yellow-800': notification.type === 'warning'
                 }"
                 class="flex items-center justify-between p-4 rounded-lg shadow-lg border-l-4">
                <div class="flex items-center space-x-3">
                    <span x-show="notification.type === 'success'" class="text-2xl">‚úÖ</span>
                    <span x-show="notification.type === 'error'" class="text-2xl">‚ùå</span>
                    <span x-show="notification.type === 'info'" class="text-2xl">‚ÑπÔ∏è</span>
                    <span x-show="notification.type === 'warning'" class="text-2xl">‚ö†Ô∏è</span>
                    <p class="text-sm font-medium" x-text="notification.message"></p>
                </div>
                <button @click="removeNotification(notification.id)"
                        class="ml-4 text-gray-400 hover:text-gray-600 transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
        </template>
    </div>

    <!-- Confirmation Dialog -->
    <div x-show="confirmDialog.show"
         x-cloak
         class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"
         @click.self="cancelAction()">
        <div class="bg-white rounded-lg shadow-xl p-6 max-w-md w-full mx-4"
             x-transition:enter="transform ease-out duration-300 transition"
             x-transition:enter-start="scale-90 opacity-0"
             x-transition:enter-end="scale-100 opacity-100"
             x-transition:leave="transform ease-in duration-200 transition"
             x-transition:leave-start="scale-100 opacity-100"
             x-transition:leave-end="scale-90 opacity-0">
            <div class="flex items-center space-x-4 mb-4">
                <div class="flex-shrink-0">
                    <span class="text-4xl">‚ö†Ô∏è</span>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-gray-900">Best√§tigung erforderlich</h3>
                    <p class="text-sm text-gray-600 mt-1" x-text="confirmDialog.message"></p>
                </div>
            </div>
            <div class="flex justify-end space-x-3">
                <button @click="cancelAction()"
                        class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-medium">
                    Abbrechen
                </button>
                <button @click="confirmAction()"
                        class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors font-medium">
                    Best√§tigen
                </button>
            </div>
        </div>
    </div>

    <!-- Session Management Dialog -->
    <div x-show="sessionDialog.show"
         x-cloak
         class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"
         @click.self="closeSessionDialog()">
        <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"
             x-transition:enter="transform ease-out duration-300 transition"
             x-transition:enter-start="scale-90 opacity-0"
             x-transition:enter-end="scale-100 opacity-100"
             x-transition:leave="transform ease-in duration-200 transition"
             x-transition:leave-start="scale-100 opacity-100"
             x-transition:leave-end="scale-90 opacity-0">

            <!-- Dialog Header -->
            <div class="flex items-center justify-between p-6 border-b border-gray-200">
                <h3 class="text-xl font-bold text-gray-900">
                    <span x-show="sessionDialog.mode === 'create'">Neue Session erstellen</span>
                    <span x-show="sessionDialog.mode === 'manage'">Sessions verwalten</span>
                </h3>
                <button @click="closeSessionDialog()"
                        class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <!-- Dialog Content -->
            <div class="p-6">

                <!-- Create Mode -->
                <div x-show="sessionDialog.mode === 'create'" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Session-Name *
                        </label>
                        <input type="text"
                               x-model="sessionDialog.newSession.name"
                               @keydown.enter="createSession()"
                               placeholder="z.B. Twitter_M√§rz_2025"
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Beschreibung (optional)
                        </label>
                        <textarea x-model="sessionDialog.newSession.description"
                                  rows="3"
                                  placeholder="Beschreibe diese Analysesitzung..."
                                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                    </div>

                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <div class="flex items-start space-x-2">
                            <svg class="w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            <div class="text-sm text-blue-700">
                                <p class="font-medium mb-1">Nach dem Erstellen:</p>
                                <ul class="list-disc list-inside space-y-1 text-blue-600">
                                    <li>Die neue Session wird automatisch aktiviert</li>
                                    <li>Du kannst dann CSV-Daten f√ºr diese Session importieren</li>
                                    <li>Alle Analysen beziehen sich auf die aktive Session</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-end space-x-3 pt-4">
                        <button @click="closeSessionDialog()"
                                class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-medium">
                            Abbrechen
                        </button>
                        <button @click="createSession()"
                                class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors font-medium">
                            Session erstellen
                        </button>
                    </div>
                </div>

                <!-- Manage Mode -->
                <div x-show="sessionDialog.mode === 'manage'" class="space-y-4">

                    <div class="mb-4">
                        <button @click="sessionDialog.mode = 'create'"
                                class="w-full px-4 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors flex items-center justify-center space-x-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                            </svg>
                            <span>Neue Session erstellen</span>
                        </button>
                    </div>

                    <!-- Sessions List -->
                    <div class="space-y-3">
                        <template x-for="session in sessions" :key="session.id">
                            <div class="border rounded-lg p-4 hover:bg-gray-50 transition-colors"
                                 :class="activeSession && activeSession.id === session.id ? 'border-blue-500 bg-blue-50' : 'border-gray-200'">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <div class="flex items-center space-x-2 mb-2">
                                            <h4 class="font-semibold text-gray-900" x-text="session.name"></h4>
                                            <span x-show="activeSession && activeSession.id === session.id"
                                                  class="px-2 py-0.5 bg-blue-500 text-white text-xs rounded-full">
                                                Aktiv
                                            </span>
                                        </div>
                                        <p class="text-sm text-gray-600 mb-2" x-text="session.description || 'Keine Beschreibung'"></p>
                                        <div class="flex items-center space-x-4 text-xs text-gray-500">
                                            <span>
                                                <strong x-text="session.post_count || 0"></strong> Posts
                                            </span>
                                            <span>
                                                Erstellt: <span x-text="new Date(session.created_at).toLocaleDateString('de-DE')"></span>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="flex space-x-2 ml-4">
                                        <button x-show="!(activeSession && activeSession.id === session.id)"
                                                @click="switchSession(session.id)"
                                                class="px-3 py-1.5 bg-blue-500 hover:bg-blue-600 text-white text-sm rounded-lg transition-colors">
                                            Aktivieren
                                        </button>
                                        <button x-show="!(activeSession && activeSession.id === session.id)"
                                                @click="deleteSession(session.id, session.name)"
                                                class="px-3 py-1.5 bg-red-500 hover:bg-red-600 text-white text-sm rounded-lg transition-colors">
                                            L√∂schen
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </template>

                        <div x-show="sessions.length === 0" class="text-center py-12 text-gray-400">
                            <svg class="w-16 h-16 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/>
                            </svg>
                            <p class="text-lg">Keine Sessions vorhanden</p>
                            <p class="text-sm mt-2">Erstelle deine erste Analysesitzung</p>
                        </div>
                    </div>

                    <div class="flex justify-end pt-4">
                        <button @click="closeSessionDialog()"
                                class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-medium">
                            Schlie√üen
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

        <!-- Tabs Navigation -->
        <div class="mb-6">
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-8">
                    <button @click="currentTab = 'upload'; localStorage.setItem('currentTab', 'upload')"
                            :class="currentTab === 'upload' ? 'border-primary text-primary' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                            class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors">
                        üì§ Upload
                    </button>
                    <button @click="currentTab = 'anleitung'; localStorage.setItem('currentTab', 'anleitung')"
                            :class="currentTab === 'anleitung' ? 'border-primary text-primary' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                            class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors">
                        üìñ Anleitung
                    </button>
                    <button @click="currentTab = 'review'; localStorage.setItem('currentTab', 'review')"
                            :class="currentTab === 'review' ? 'border-primary text-primary' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                            class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors">
                        üìù Review Posts
                    </button>
                    <button @click="currentTab = 'reviewed'; localStorage.setItem('currentTab', 'reviewed')"
                            :class="currentTab === 'reviewed' ? 'border-primary text-primary' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                            class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors">
                        ‚úÖ Reviewed Posts
                    </button>
                    <button @click="currentTab = 'statistics'; localStorage.setItem('currentTab', 'statistics'); $nextTick(() => renderTimelineCharts())"
                            :class="currentTab === 'statistics' ? 'border-primary text-primary' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                            class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors">
                        üìä Statistiken
                    </button>
                    <button @click="currentTab = 'triggers'; localStorage.setItem('currentTab', 'triggers')"
                            :class="currentTab === 'triggers' ? 'border-primary text-primary' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                            class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors">
                        üß† Trigger & Frames
                    </button>
                    <button @click="currentTab = 'advanced'; localStorage.setItem('currentTab', 'advanced'); loadAdvancedStats()"
                            :class="currentTab === 'advanced' ? 'border-primary text-primary' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                            class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors">
                        üìà Erweiterte Statistiken
                    </button>
                    <button @click="currentTab = 'favorites'; localStorage.setItem('currentTab', 'favorites'); loadFavoritePosts()"
                            :class="currentTab === 'favorites' ? 'border-primary text-primary' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                            class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors relative">
                        ‚≠ê Favoriten
                        <span x-show="favoritePosts.length > 0"
                              class="absolute -top-1 -right-1 bg-yellow-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center"
                              x-text="favoritePosts.length"></span>
                    </button>
                    <button @click="currentTab = 'archive'; localStorage.setItem('currentTab', 'archive'); loadArchivedPosts()"
                            :class="currentTab === 'archive' ? 'border-primary text-primary' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                            class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors relative">
                        üì¶ Archiv
                        <span x-show="statistics.archived_posts > 0"
                              class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center"
                              x-text="statistics.archived_posts"></span>
                    </button>
                </nav>
            </div>
        </div>

        <!-- Tab Content -->
        <div x-cloak>

            <!-- ===== UPLOAD TAB ===== -->
            <div x-show="currentTab === 'upload'" class="fade-in">
                <div class="bg-white rounded-lg shadow-lg p-8">
                    <h2 class="text-2xl font-bold mb-4 text-gray-900">CSV-Datei hochladen</h2>
                    <p class="text-gray-600 mb-6">
                        Lade eine CSV-Datei mit Twitter-Daten hoch. Die Datei wird automatisch verarbeitet und TER-Scores werden berechnet.
                    </p>

                    <!-- Upload Area -->
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-12 text-center hover:border-primary transition-colors"
                         @dragover.prevent="dragOver = true"
                         @dragleave.prevent="dragOver = false"
                         @drop.prevent="handleFileDrop($event)"
                         :class="{ 'border-primary bg-blue-50': dragOver }">

                        <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                        </svg>

                        <div class="mb-4">
                            <label for="file-upload" class="cursor-pointer">
                                <span class="bg-primary text-white px-6 py-3 rounded-lg font-medium hover:bg-blue-600 transition-colors inline-block">
                                    Datei ausw√§hlen
                                </span>
                                <input id="file-upload" type="file" accept=".csv" @change="handleFileSelect($event)" class="hidden">
                            </label>
                        </div>

                        <p class="text-sm text-gray-500">oder Datei hierher ziehen</p>

                        <p class="text-xs text-gray-400 mt-4" x-show="selectedFile" x-text="selectedFile ? selectedFile.name : ''"></p>
                    </div>

                    <!-- Upload Button -->
                    <div class="mt-6 flex justify-end">
                        <button @click="uploadFile()"
                                :disabled="!selectedFile || uploading"
                                :class="{ 'opacity-50 cursor-not-allowed': !selectedFile || uploading }"
                                class="bg-success text-white px-8 py-3 rounded-lg font-medium hover:bg-green-600 transition-colors flex items-center space-x-2">
                            <span x-show="!uploading">Hochladen & Importieren</span>
                            <span x-show="uploading">
                                <svg class="animate-spin h-5 w-5 inline-block" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                                Importiere...
                            </span>
                        </button>
                    </div>

                    <!-- Upload Result -->
                    <div x-show="uploadResult" class="mt-6 p-4 rounded-lg" :class="uploadResult?.success ? 'bg-green-50 border border-green-200' : 'bg-red-50 border border-red-200'">
                        <div class="flex items-start">
                            <svg x-show="uploadResult?.success" class="h-6 w-6 text-green-500 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                            </svg>
                            <svg x-show="!uploadResult?.success" class="h-6 w-6 text-red-500 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                            </svg>
                            <div>
                                <p class="font-medium" :class="uploadResult?.success ? 'text-green-800' : 'text-red-800'" x-text="uploadResult?.message"></p>
                                <div x-show="uploadResult?.success" class="mt-2 text-sm text-green-700">
                                    <p>‚úì Importiert: <span x-text="uploadResult?.imported || 0"></span> neue Posts</p>
                                    <p>‚úì Aktualisiert: <span x-text="uploadResult?.updated || 0"></span> Posts</p>
                                    <p x-show="uploadResult?.skipped > 0">‚äò √úbersprungen: <span x-text="uploadResult?.skipped || 0"></span> Posts</p>
                                </div>
                                <p x-show="!uploadResult?.success" class="mt-1 text-sm text-red-700" x-text="uploadResult?.error"></p>
                            </div>
                        </div>
                    </div>

                    <!-- Expected Format -->
                    <div class="mt-8 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <h3 class="font-semibold text-blue-900 mb-2">üìã Erwartetes CSV-Format:</h3>
                        <code class="text-xs text-blue-800 block overflow-x-auto">
                            factcheck_url, factcheck_title, factcheck_date, twitter_url, twitter_author, twitter_handle, twitter_followers, twitter_content, twitter_date, likes, retweets, replies, bookmarks, quotes, views, TER
                        </code>
                    </div>
                </div>

                <!-- CSV Data Preview -->
                <div class="mt-8">
                    <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                        <div class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-6 py-4">
                            <h2 class="text-2xl font-bold">üìä Importierte Daten (Tabellenansicht)</h2>
                            <p class="text-sm text-indigo-100 mt-1">Alle Posts aus der CSV-Datei</p>
                        </div>

                        <div class="p-6">
                            <!-- Stats Summary -->
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                                <div class="bg-blue-50 rounded-lg p-4 text-center">
                                    <div class="text-3xl font-bold text-blue-600" x-text="allPosts.length"></div>
                                    <div class="text-sm text-gray-600 mt-1">Gesamt Posts</div>
                                </div>
                                <div class="bg-green-50 rounded-lg p-4 text-center">
                                    <div class="text-3xl font-bold text-green-600" x-text="allPosts.filter(p => p.is_reviewed).length"></div>
                                    <div class="text-sm text-gray-600 mt-1">Reviewed</div>
                                </div>
                                <div class="bg-yellow-50 rounded-lg p-4 text-center">
                                    <div class="text-3xl font-bold text-yellow-600" x-text="allPosts.filter(p => !p.is_reviewed).length"></div>
                                    <div class="text-sm text-gray-600 mt-1">Unreviewed</div>
                                </div>
                                <div class="bg-purple-50 rounded-lg p-4 text-center">
                                    <div class="text-3xl font-bold text-purple-600" x-text="allPosts.filter(p => p.ter_manual !== null).length"></div>
                                    <div class="text-sm text-gray-600 mt-1">Mit TER (Manuell)</div>
                                </div>
                            </div>

                            <!-- Table -->
                            <div class="overflow-x-auto border border-gray-200 rounded-lg">
                                <table class="w-full min-w-full">
                                    <thead class="bg-gradient-to-r from-gray-50 to-gray-100">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-b">#</th>
                                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-b">Twitter Handle</th>
                                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-b">Content</th>
                                            <th class="px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-b">Datum</th>
                                            <th class="px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-b">Views</th>
                                            <th class="px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-b">Likes</th>
                                            <th class="px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-b">Retweets</th>
                                            <th class="px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-b">Replies</th>
                                            <th class="px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-b">Bookmarks</th>
                                            <th class="px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-b">Quotes</th>
                                            <th class="px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-b">TER Auto</th>
                                            <th class="px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-b">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200 bg-white">
                                        <template x-for="(post, index) in allPosts" :key="post.id">
                                            <tr class="hover:bg-gray-50 transition-colors">
                                                <td class="px-4 py-3 text-sm text-gray-900 font-semibold" x-text="index + 1"></td>
                                                <td class="px-4 py-3">
                                                    <div class="text-sm font-medium text-gray-900" x-text="'@' + post.twitter_handle"></div>
                                                    <div class="text-xs text-gray-500" x-text="post.twitter_followers.toLocaleString() + ' Followers'"></div>
                                                </td>
                                                <td class="px-4 py-3 max-w-xs">
                                                    <div class="text-sm text-gray-700 line-clamp-2" x-text="post.twitter_content"></div>
                                                </td>
                                                <td class="px-4 py-3 text-center text-sm text-gray-600" x-text="post.twitter_date"></td>
                                                <td class="px-4 py-3 text-center text-sm font-semibold text-blue-600" x-text="post.views.toLocaleString()"></td>
                                                <td class="px-4 py-3 text-center text-sm font-semibold text-red-600" x-text="post.likes.toLocaleString()"></td>
                                                <td class="px-4 py-3 text-center text-sm font-semibold text-green-600" x-text="post.retweets.toLocaleString()"></td>
                                                <td class="px-4 py-3 text-center text-sm font-semibold text-purple-600" x-text="post.replies.toLocaleString()"></td>
                                                <td class="px-4 py-3 text-center text-sm font-semibold text-yellow-600" x-text="post.bookmarks.toLocaleString()"></td>
                                                <td class="px-4 py-3 text-center text-sm font-semibold text-indigo-600" x-text="post.quotes.toLocaleString()"></td>
                                                <td class="px-4 py-3 text-center">
                                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800" x-text="post.ter_automatic.toFixed(2) + '%'"></span>
                                                </td>
                                                <td class="px-4 py-3 text-center">
                                                    <span x-show="post.is_reviewed" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                                        Reviewed
                                                    </span>
                                                    <span x-show="!post.is_reviewed" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                                                        Pending
                                                    </span>
                                                </td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>

                            <!-- Empty State -->
                            <div x-show="allPosts.length === 0" class="text-center py-12">
                                <svg class="h-16 w-16 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                </svg>
                                <p class="text-gray-500 text-lg">Keine Daten vorhanden</p>
                                <p class="text-sm text-gray-400 mt-2">Lade eine CSV-Datei hoch, um die Daten hier zu sehen</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ===== ANLEITUNG TAB ===== -->
            <div x-show="currentTab === 'anleitung'" class="fade-in">
                <div class="bg-white rounded-lg shadow-lg p-8">
                    <h2 class="text-3xl font-bold mb-2 text-gray-900">üìñ Anleitung zur Datenanalyse</h2>
                    <p class="text-gray-600 mb-8">
                        Befolge diese Schritte, um eine korrekte und systematische Analyse deiner Twitter-Daten durchzuf√ºhren.
                    </p>

                    <!-- Steps -->
                    <div class="space-y-6">

                        <!-- Step 1: Upload -->
                        <div class="bg-gradient-to-r from-blue-50 to-blue-100 border-l-4 border-blue-500 rounded-lg p-6">
                            <div class="flex items-start">
                                <div class="flex-shrink-0">
                                    <div class="flex items-center justify-center h-12 w-12 rounded-full bg-blue-500 text-white text-xl font-bold">
                                        1
                                    </div>
                                </div>
                                <div class="ml-6 flex-1">
                                    <h3 class="text-xl font-bold text-gray-900 mb-2">üì§ CSV-Datei hochladen</h3>
                                    <p class="text-gray-700 mb-3">
                                        Lade deine CSV-Datei mit den Twitter-Daten √ºber den <strong>"Upload"</strong> Tab hoch.
                                        Das System importiert alle Posts und berechnet automatisch die TER-Scores.
                                    </p>
                                    <div class="bg-white rounded-lg p-4 mt-3">
                                        <p class="text-sm text-gray-600">
                                            <strong>Wichtig:</strong> Die CSV-Datei sollte alle erforderlichen Spalten enthalten
                                            (twitter_url, likes, retweets, replies, bookmarks, quotes, views, etc.)
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Step 2: Archive -->
                        <div class="bg-gradient-to-r from-red-50 to-red-100 border-l-4 border-red-500 rounded-lg p-6">
                            <div class="flex items-start">
                                <div class="flex-shrink-0">
                                    <div class="flex items-center justify-center h-12 w-12 rounded-full bg-red-500 text-white text-xl font-bold">
                                        2
                                    </div>
                                </div>
                                <div class="ml-6 flex-1">
                                    <h3 class="text-xl font-bold text-gray-900 mb-2">üì¶ Nicht verf√ºgbare Posts archivieren</h3>
                                    <p class="text-gray-700 mb-3">
                                        <strong>‚ö†Ô∏è WICHTIG: Dieser Schritt MUSS zuerst durchgef√ºhrt werden!</strong>
                                    </p>
                                    <p class="text-gray-700 mb-3">
                                        Gehe zum <strong>"Review Posts"</strong> Tab und pr√ºfe jeden Post, ob er noch auf Twitter verf√ºgbar ist.
                                        Posts, die gel√∂scht wurden oder nicht mehr abrufbar sind, m√ºssen <strong>sofort archiviert</strong> werden.
                                    </p>
                                    <div class="bg-white rounded-lg p-4 mt-3 border-2 border-red-300">
                                        <p class="text-sm text-red-800 font-semibold mb-2">
                                            ‚ö†Ô∏è Warum ist das wichtig?
                                        </p>
                                        <ul class="text-sm text-gray-700 space-y-1 list-disc list-inside">
                                            <li>Archivierte Posts werden von allen Statistiken und Analysen ausgeschlossen</li>
                                            <li>Nicht verf√ºgbare Posts verf√§lschen die Datenqualit√§t</li>
                                            <li>Du kannst keine aktuellen Metriken f√ºr gel√∂schte Posts erheben</li>
                                            <li>Die manuelle TER-Berechnung erfordert aktuelle, valide Daten</li>
                                        </ul>
                                    </div>
                                    <div class="bg-red-500 text-white rounded-lg p-4 mt-3">
                                        <p class="font-bold text-lg mb-2">üö® Vorgehensweise:</p>
                                        <ol class="text-sm space-y-2 list-decimal list-inside">
                                            <li>√ñffne jeden Twitter-Link im Browser</li>
                                            <li>Pr√ºfe, ob der Post noch existiert und zug√§nglich ist</li>
                                            <li>Falls NICHT: Klicke auf "Archivieren" (üì¶ Symbol)</li>
                                            <li>Wiederhole dies f√ºr ALLE Posts, bevor du mit Schritt 3 weitermachst</li>
                                        </ol>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Step 3: Manual Review -->
                        <div class="bg-gradient-to-r from-green-50 to-green-100 border-l-4 border-green-500 rounded-lg p-6">
                            <div class="flex items-start">
                                <div class="flex-shrink-0">
                                    <div class="flex items-center justify-center h-12 w-12 rounded-full bg-green-500 text-white text-xl font-bold">
                                        3
                                    </div>
                                </div>
                                <div class="ml-6 flex-1">
                                    <h3 class="text-xl font-bold text-gray-900 mb-2">üìù Aktuelle Metriken erfassen & TER berechnen</h3>
                                    <p class="text-gray-700 mb-3">
                                        Jetzt kannst du f√ºr die <strong>verf√ºgbaren Posts</strong> die aktuellen Engagement-Metriken erfassen:
                                    </p>
                                    <div class="bg-white rounded-lg p-4 mt-3">
                                        <ol class="text-sm text-gray-700 space-y-2 list-decimal list-inside">
                                            <li><strong>TER-Rechner √∂ffnen:</strong> Klicke auf "üßÆ TER berechnen"</li>
                                            <li><strong>Metriken eingeben:</strong> Trage die aktuellen Werte ein (Views, Likes, Retweets, etc.)</li>
                                            <li><strong>TER speichern:</strong> Klicke auf "üíæ TER speichern"</li>
                                            <li><strong>Als reviewed markieren:</strong> Setze den Haken bei "Reviewed" ‚úÖ</li>
                                        </ol>
                                    </div>
                                    <div class="bg-green-100 rounded-lg p-4 mt-3">
                                        <p class="text-sm text-green-800">
                                            <strong>üí° Tipp:</strong> Nutze die Tastaturnavigation (Pfeiltasten) im TER-Rechner,
                                            um schnell zwischen den Eingabefeldern zu wechseln!
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Step 4: Trigger & Frames -->
                        <div class="bg-gradient-to-r from-purple-50 to-purple-100 border-l-4 border-purple-500 rounded-lg p-6">
                            <div class="flex items-start">
                                <div class="flex-shrink-0">
                                    <div class="flex items-center justify-center h-12 w-12 rounded-full bg-purple-500 text-white text-xl font-bold">
                                        4
                                    </div>
                                </div>
                                <div class="ml-6 flex-1">
                                    <h3 class="text-xl font-bold text-gray-900 mb-2">üß† Trigger & Frames codieren</h3>
                                    <p class="text-gray-700 mb-3">
                                        Gehe zum Tab <strong>"Trigger & Frames"</strong> und codiere die emotionalen Trigger und narrativen Frames:
                                    </p>
                                    <div class="bg-white rounded-lg p-4 mt-3">
                                        <p class="text-sm text-gray-700 mb-2"><strong>Trigger (Intensit√§t 0-5):</strong></p>
                                        <ul class="text-sm text-gray-600 space-y-1 list-disc list-inside ml-4">
                                            <li>Angst/Bedrohung</li>
                                            <li>Wut/Emp√∂rung</li>
                                            <li>Ekel</li>
                                            <li>Identit√§tsbezug</li>
                                            <li>Hoffnung/Stolz</li>
                                        </ul>
                                        <p class="text-sm text-gray-700 mt-3 mb-2"><strong>Frames (Bin√§r 0/1):</strong></p>
                                        <ul class="text-sm text-gray-600 space-y-1 list-disc list-inside ml-4">
                                            <li>Opfer-T√§ter-Frame</li>
                                            <li>Bedrohungs-Frame</li>
                                            <li>Verschw√∂rungs-Frame</li>
                                            <li>Moral-Frame</li>
                                            <li>Historischer Frame</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Step 5: Statistics -->
                        <div class="bg-gradient-to-r from-indigo-50 to-indigo-100 border-l-4 border-indigo-500 rounded-lg p-6">
                            <div class="flex items-start">
                                <div class="flex-shrink-0">
                                    <div class="flex items-center justify-center h-12 w-12 rounded-full bg-indigo-500 text-white text-xl font-bold">
                                        5
                                    </div>
                                </div>
                                <div class="ml-6 flex-1">
                                    <h3 class="text-xl font-bold text-gray-900 mb-2">üìä Statistiken & Analysen ansehen</h3>
                                    <p class="text-gray-700 mb-3">
                                        Nachdem alle Posts reviewed und codiert sind, kannst du die statistischen Analysen durchf√ºhren:
                                    </p>
                                    <div class="bg-white rounded-lg p-4 mt-3">
                                        <ul class="text-sm text-gray-700 space-y-2">
                                            <li>üìä <strong>Statistiken:</strong> Deskriptive Statistiken und Zeitreihen-Analysen</li>
                                            <li>üìà <strong>Erweiterte Statistiken:</strong> Korrelationen, Regressionen, Gruppenvergleiche, Clusteranalyse</li>
                                        </ul>
                                    </div>
                                    <div class="bg-indigo-100 rounded-lg p-4 mt-3">
                                        <p class="text-sm text-indigo-800">
                                            <strong>üìå Hinweis:</strong> Nur reviewed Posts werden in die Statistiken einbezogen.
                                            Archivierte Posts sind komplett ausgeschlossen.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                    <!-- Quick Reference Card -->
                    <div class="mt-8 bg-gradient-to-r from-yellow-50 to-orange-50 border-2 border-yellow-400 rounded-lg p-6">
                        <h3 class="text-lg font-bold text-gray-900 mb-3">‚ö° Schnell√ºbersicht</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                            <div>
                                <p class="font-semibold text-gray-800 mb-2">‚úÖ Korrekte Reihenfolge:</p>
                                <ol class="list-decimal list-inside space-y-1 text-gray-700">
                                    <li>CSV hochladen</li>
                                    <li><strong>Nicht verf√ºgbare Posts archivieren</strong></li>
                                    <li>TER-Werte berechnen & speichern</li>
                                    <li>Trigger & Frames codieren</li>
                                    <li>Statistiken analysieren</li>
                                </ol>
                            </div>
                            <div>
                                <p class="font-semibold text-gray-800 mb-2">‚ùå H√§ufige Fehler vermeiden:</p>
                                <ul class="list-disc list-inside space-y-1 text-gray-700">
                                    <li>Posts NICHT archivieren ‚Üí Falsche Statistiken</li>
                                    <li>TER berechnen ohne Archivierung ‚Üí Ung√ºltige Daten</li>
                                    <li>Unvollst√§ndige Trigger-Codierung ‚Üí L√ºckenhafte Analyse</li>
                                    <li>Posts als reviewed markieren ohne TER ‚Üí Fehler in Clusteranalyse</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Navigation Buttons -->
                    <div class="mt-8 flex justify-between">
                        <button @click="currentTab = 'upload'; localStorage.setItem('currentTab', 'upload')"
                                class="bg-gray-500 text-white px-6 py-3 rounded-lg font-medium hover:bg-gray-600 transition-colors">
                            ‚Üê Zur√ºck zum Upload
                        </button>
                        <button @click="currentTab = 'review'; localStorage.setItem('currentTab', 'review')"
                                class="bg-green-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-green-700 transition-colors">
                            Los geht's mit Review Posts ‚Üí
                        </button>
                    </div>
                </div>
            </div>

            <!-- ===== REVIEW TAB ===== -->
            <div x-show="currentTab === 'review'" class="fade-in">

                <!-- Posts Counter -->
                <div class="bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200 rounded-lg shadow-md p-4 mb-4">
                    <div class="flex flex-wrap items-center justify-between gap-4">
                        <div class="flex items-center space-x-6">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-blue-600" x-text="stats.total_posts"></div>
                                <div class="text-xs text-gray-600">Aktive Posts</div>
                            </div>
                            <div class="h-10 w-px bg-gray-300"></div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-green-600" x-text="stats.reviewed_posts"></div>
                                <div class="text-xs text-gray-600">Reviewed</div>
                            </div>
                            <div class="h-10 w-px bg-gray-300"></div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-orange-600" x-text="stats.unreviewed_posts"></div>
                                <div class="text-xs text-gray-600">Unreviewed</div>
                            </div>
                            <div class="h-10 w-px bg-gray-300"></div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-red-600" x-text="statistics.archived_posts || 0"></div>
                                <div class="text-xs text-gray-600">Archiviert</div>
                            </div>
                            <div class="h-10 w-px bg-gray-300"></div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-purple-600" x-text="stats.total_posts > 0 ? Math.round((stats.reviewed_posts / stats.total_posts) * 100) + '%' : '0%'"></div>
                                <div class="text-xs text-gray-600">Fortschritt</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Filter Bar -->
                <div class="bg-white rounded-lg shadow-md p-4 mb-6">
                    <div class="flex flex-wrap items-center gap-4">
                        <div class="flex-1 min-w-[200px]">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Filter</label>
                            <select @change="loadPosts()" x-model="filter.reviewed" class="w-full rounded-lg border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50">
                                <option value="all">Alle Posts</option>
                                <option value="false">Nur Unreviewed</option>
                                <option value="true">Nur Reviewed</option>
                            </select>
                        </div>

                        <div class="flex-1 min-w-[200px]">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Sortierung</label>
                            <select @change="loadPosts()" x-model="filter.sort" class="w-full rounded-lg border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50">
                                <option value="created_at">Datum (Neueste)</option>
                                <option value="ter_automatic">TER (H√∂chste)</option>
                                <option value="views">Views (H√∂chste)</option>
                                <option value="followers">Followers (H√∂chste)</option>
                            </select>
                        </div>

                        <!-- Handle Filter Dropdown -->
                        <div class="flex-1 min-w-[250px] relative" x-data="{ open: false }" @click.away="open = false">
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Filter nach Ersteller (@)
                                <span class="text-xs text-gray-500">(<span x-text="selectedHandles.length"></span>/<span x-text="availableHandles.length"></span> ausgew√§hlt)</span>
                            </label>
                            <div>
                                <button @click="open = !open" type="button"
                                        class="w-full bg-white border border-gray-300 rounded-lg px-4 py-2 text-left shadow-sm hover:bg-gray-50 focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 flex items-center justify-between">
                                    <span class="text-sm text-gray-700">
                                        <span x-show="selectedHandles.length === 0">Keine ausgew√§hlt</span>
                                        <span x-show="selectedHandles.length > 0 && selectedHandles.length === availableHandles.length">Alle ausgew√§hlt</span>
                                        <span x-show="selectedHandles.length > 0 && selectedHandles.length < availableHandles.length" x-text="selectedHandles.length + ' ausgew√§hlt'"></span>
                                    </span>
                                    <svg class="w-5 h-5 text-gray-400" :class="{ 'rotate-180': open }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>

                                <!-- Dropdown Menu -->
                                <div x-show="open"
                                     x-transition:enter="transition ease-out duration-100"
                                     x-transition:enter-start="opacity-0 scale-95"
                                     x-transition:enter-end="opacity-100 scale-100"
                                     x-transition:leave="transition ease-in duration-75"
                                     x-transition:leave-start="opacity-100 scale-100"
                                     x-transition:leave-end="opacity-0 scale-95"
                                     class="absolute z-50 mt-1 w-full bg-white border border-gray-300 rounded-lg shadow-lg max-h-64 overflow-y-auto">

                                    <!-- Select All / Deselect All -->
                                    <div class="sticky top-0 bg-gray-50 border-b border-gray-200 p-2 flex gap-2">
                                        <button @click="selectAllHandles()" type="button"
                                                class="flex-1 bg-green-500 text-white px-3 py-1 rounded text-xs hover:bg-green-600 transition-colors">
                                            ‚úì Alle ausw√§hlen
                                        </button>
                                        <button @click="deselectAllHandles()" type="button"
                                                class="flex-1 bg-red-500 text-white px-3 py-1 rounded text-xs hover:bg-red-600 transition-colors">
                                            ‚úó Alle abw√§hlen
                                        </button>
                                    </div>

                                    <!-- Handle List -->
                                    <template x-for="handle in availableHandles" :key="handle">
                                        <div @click="toggleHandle(handle)"
                                             class="px-4 py-2 hover:bg-blue-50 cursor-pointer flex items-center justify-between">
                                            <span class="text-sm text-gray-700" x-text="'@' + handle"></span>
                                            <svg x-show="selectedHandles.includes(handle)" class="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                            </svg>
                                        </div>
                                    </template>

                                    <!-- Empty State -->
                                    <div x-show="availableHandles.length === 0" class="px-4 py-3 text-sm text-gray-500 text-center">
                                        Keine Twitter-Handles verf√ºgbar
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Factchecker Filter Dropdown -->
                        <div class="flex-1 min-w-[250px] relative" x-data="{ open: false }" @click.away="open = false">
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Filter nach Faktenchecker
                                <span class="text-xs text-gray-500">(<span x-text="selectedFactcheckers.length"></span>/<span x-text="availableFactcheckers.length"></span> ausgew√§hlt)</span>
                            </label>
                            <div>
                                <button @click="open = !open" type="button"
                                        class="w-full bg-white border border-gray-300 rounded-lg px-4 py-2 text-left shadow-sm hover:bg-gray-50 focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 flex items-center justify-between">
                                    <span class="text-sm text-gray-700">
                                        <span x-show="selectedFactcheckers.length === 0">Keine ausgew√§hlt</span>
                                        <span x-show="selectedFactcheckers.length > 0 && selectedFactcheckers.length === availableFactcheckers.length">Alle ausgew√§hlt</span>
                                        <span x-show="selectedFactcheckers.length > 0 && selectedFactcheckers.length < availableFactcheckers.length" x-text="selectedFactcheckers.length + ' ausgew√§hlt'"></span>
                                    </span>
                                    <svg class="w-5 h-5 text-gray-400" :class="{ 'rotate-180': open }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>

                                <!-- Dropdown Menu -->
                                <div x-show="open"
                                     x-transition:enter="transition ease-out duration-100"
                                     x-transition:enter-start="opacity-0 scale-95"
                                     x-transition:enter-end="opacity-100 scale-100"
                                     x-transition:leave="transition ease-in duration-75"
                                     x-transition:leave-start="opacity-100 scale-100"
                                     x-transition:leave-end="opacity-0 scale-95"
                                     class="absolute z-50 mt-1 w-full bg-white border border-gray-300 rounded-lg shadow-lg max-h-64 overflow-y-auto">

                                    <!-- Select All / Deselect All -->
                                    <div class="sticky top-0 bg-gray-50 border-b border-gray-200 p-2 flex gap-2">
                                        <button @click="selectAllFactcheckers()" type="button"
                                                class="flex-1 bg-green-500 text-white px-3 py-1 rounded text-xs hover:bg-green-600 transition-colors">
                                            ‚úì Alle ausw√§hlen
                                        </button>
                                        <button @click="deselectAllFactcheckers()" type="button"
                                                class="flex-1 bg-red-500 text-white px-3 py-1 rounded text-xs hover:bg-red-600 transition-colors">
                                            ‚úó Alle abw√§hlen
                                        </button>
                                    </div>

                                    <!-- Factchecker List -->
                                    <template x-for="factchecker in availableFactcheckers" :key="factchecker.domain">
                                        <div @click="toggleFactchecker(factchecker.domain)"
                                             class="px-4 py-2 hover:bg-blue-50 cursor-pointer flex items-center justify-between">
                                            <span class="text-sm text-gray-700" x-text="factchecker.name"></span>
                                            <svg x-show="selectedFactcheckers.includes(factchecker.domain)" class="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                            </svg>
                                        </div>
                                    </template>

                                    <!-- Empty State -->
                                    <div x-show="availableFactcheckers.length === 0" class="px-4 py-3 text-sm text-gray-500 text-center">
                                        Keine Faktenchecker verf√ºgbar
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="flex items-end">
                            <button @click="loadPosts()" class="bg-primary text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                                üîÑ Aktualisieren
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Posts List -->
                <div x-show="loading" class="text-center py-12">
                    <svg class="animate-spin h-12 w-12 mx-auto text-primary" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <p class="mt-4 text-gray-500">Lade Posts...</p>
                </div>

                <div x-show="!loading && posts.length === 0" class="text-center py-12 bg-white rounded-lg shadow-md">
                    <svg class="h-16 w-16 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"/>
                    </svg>
                    <p class="text-gray-500">Keine Posts gefunden</p>
                    <p class="text-sm text-gray-400 mt-2">Lade zuerst eine CSV-Datei hoch</p>
                </div>

                <!-- Post Card -->
                <template x-for="(post, index) in paginatedPosts" :key="post.id">
                    <div class="bg-white rounded-lg shadow-md p-6 mb-4 card-hover" :class="{ 'border-2 border-green-500': post.is_reviewed }">

                        <!-- Header -->
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex-1">
                                <div class="flex items-center space-x-2 mb-2">
                                    <span class="text-sm font-semibold text-gray-500" x-text="'#' + (((pagination.currentPage - 1) * pagination.itemsPerPage) + index + 1)"></span>
                                    <span x-show="post.is_reviewed" class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full font-medium">‚úì Reviewed</span>
                                    <span x-show="!post.is_reviewed" class="bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded-full font-medium">‚è≥ Unreviewed</span>
                                </div>
                                <h3 class="text-lg font-bold text-gray-900 mb-1" x-text="post.factcheck_title || 'Kein Titel'"></h3>
                                <div class="flex items-center space-x-2 text-sm text-gray-500">
                                    <div class="flex items-center space-x-2">
                                        <span>üìÖ</span>
                                        <input type="text"
                                               :value="post.twitter_date"
                                               @blur="updateTwitterDate(post.id, $event.target.value)"
                                               class="bg-gray-50 border border-gray-200 rounded px-2 py-1 text-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50"
                                               placeholder="Tweet-Datum"
                                               style="width: 150px;">
                                    </div>
                                    <span>|</span>
                                    <div class="flex items-center space-x-2">
                                        <span>üîç</span>
                                        <input type="text"
                                               :value="post.access_date"
                                               @blur="updateAccessDate(post.id, $event.target.value)"
                                               class="bg-gray-50 border border-gray-200 rounded px-2 py-1 text-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50"
                                               placeholder="Zugriffsdatum"
                                               style="width: 150px;">
                                    </div>
                                    <span>|</span>
                                    <span x-text="'@' + post.twitter_handle"></span>
                                    <span x-show="post.twitter_followers > 0" x-text="'(' + post.twitter_followers.toLocaleString() + ' Followers)'"></span>
                                </div>
                            </div>

                            <!-- Quick Actions -->
                            <div class="flex space-x-2">
                                <button @click="openTwitterUrl(post.twitter_url)"
                                        class="bg-twitter text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors text-sm font-medium">
                                    üê¶ √ñffnen
                                </button>
                                <button @click="post.showPreview = !post.showPreview"
                                        :class="post.showPreview ? 'bg-green-500' : 'bg-indigo-500'"
                                        class="text-white px-4 py-2 rounded-lg hover:opacity-90 transition-colors text-sm font-medium">
                                    <span x-text="post.showPreview ? 'üîº Vorschau' : 'üëÅÔ∏è Vorschau'"></span>
                                </button>
                                <button @click="deletePost(post.id)"
                                        class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors text-sm font-medium">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </div>

                        <!-- Live Preview (Collapsible) -->
                        <div x-show="post.showPreview" x-cloak
                             x-transition:enter="transition ease-out duration-300"
                             x-transition:enter-start="opacity-0 transform scale-95"
                             x-transition:enter-end="opacity-100 transform scale-100"
                             class="bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-300 rounded-lg p-4 mb-4">

                            <div class="flex justify-between items-center mb-3">
                                <h4 class="text-lg font-bold text-gray-900">üëÅÔ∏è Live-Vorschau</h4>
                                <button @click="post.showPreview = false" class="text-gray-500 hover:text-gray-700">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                    </svg>
                                </button>
                            </div>

                            <div class="bg-white rounded-lg shadow-inner p-2">
                                <iframe :src="post.twitter_url"
                                        class="w-full rounded border-0"
                                        style="min-height: 600px; height: 80vh;"
                                        sandbox="allow-same-origin allow-scripts allow-popups allow-forms"
                                        loading="lazy">
                                </iframe>
                            </div>

                            <div class="mt-3 text-xs text-gray-600 bg-white rounded p-2">
                                <strong>Tipp:</strong> Nutze diese Vorschau, um Engagement-Metriken direkt abzulesen, ohne zwischen Tabs wechseln zu m√ºssen.
                            </div>
                        </div>

                        <!-- Tweet Content -->
                        <div class="bg-gray-50 rounded-lg p-4 mb-4 border border-gray-200">
                            <p class="text-gray-800 text-sm leading-relaxed" x-text="post.twitter_content || 'Kein Inhalt'"></p>
                        </div>

                        <!-- Engagement Metrics (Display) -->
                        <div class="grid grid-cols-3 md:grid-cols-6 gap-3 mb-4">
                            <div class="text-center p-3 bg-blue-50 rounded-lg relative">
                                <div class="text-xl font-bold text-blue-600" x-text="(post.views_manual !== null ? post.views_manual : post.views).toLocaleString()"></div>
                                <div class="text-xs text-gray-600">Views</div>
                                <span x-show="post.views_manual !== null" class="absolute top-1 right-1 text-xs text-purple-600" title="Manuell">‚úì</span>
                            </div>
                            <div class="text-center p-3 bg-red-50 rounded-lg relative">
                                <div class="text-xl font-bold text-red-600" x-text="(post.likes_manual !== null ? post.likes_manual : post.likes).toLocaleString()"></div>
                                <div class="text-xs text-gray-600">Likes</div>
                                <span x-show="post.likes_manual !== null" class="absolute top-1 right-1 text-xs text-purple-600" title="Manuell">‚úì</span>
                            </div>
                            <div class="text-center p-3 bg-green-50 rounded-lg relative">
                                <div class="text-xl font-bold text-green-600" x-text="(post.retweets_manual !== null ? post.retweets_manual : post.retweets).toLocaleString()"></div>
                                <div class="text-xs text-gray-600">Retweets</div>
                                <span x-show="post.retweets_manual !== null" class="absolute top-1 right-1 text-xs text-purple-600" title="Manuell">‚úì</span>
                            </div>
                            <div class="text-center p-3 bg-purple-50 rounded-lg relative">
                                <div class="text-xl font-bold text-purple-600" x-text="(post.replies_manual !== null ? post.replies_manual : post.replies).toLocaleString()"></div>
                                <div class="text-xs text-gray-600">Replies</div>
                                <span x-show="post.replies_manual !== null" class="absolute top-1 right-1 text-xs text-purple-600" title="Manuell">‚úì</span>
                            </div>
                            <div class="text-center p-3 bg-yellow-50 rounded-lg relative">
                                <div class="text-xl font-bold text-yellow-600" x-text="(post.bookmarks_manual !== null ? post.bookmarks_manual : post.bookmarks).toLocaleString()"></div>
                                <div class="text-xs text-gray-600">Bookmarks</div>
                                <span x-show="post.bookmarks_manual !== null" class="absolute top-1 right-1 text-xs text-purple-600" title="Manuell">‚úì</span>
                            </div>
                            <div class="text-center p-3 bg-indigo-50 rounded-lg relative">
                                <div class="text-xl font-bold text-indigo-600" x-text="(post.quotes_manual !== null ? post.quotes_manual : post.quotes).toLocaleString()"></div>
                                <div class="text-xs text-gray-600">Quotes</div>
                                <span x-show="post.quotes_manual !== null" class="absolute top-1 right-1 text-xs text-purple-600" title="Manuell">‚úì</span>
                            </div>
                        </div>

                        <!-- Manual Engagement Input -->
                        <div class="bg-gradient-to-r from-purple-50 to-indigo-50 rounded-lg p-4 mb-4 border-2 border-purple-200">
                            <h4 class="text-sm font-bold text-gray-800 mb-3">üìù Engagement-Metriken manuell korrigieren <span class="text-xs font-normal text-gray-600">(‚Üê ‚Üí ‚Üë ‚Üì Pfeiltasten zum Navigieren)</span></h4>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-3 mb-3" x-data="{ tempEngagement: {
                                views: post.views_manual !== null ? post.views_manual : post.views,
                                likes: post.likes_manual !== null ? post.likes_manual : post.likes,
                                retweets: post.retweets_manual !== null ? post.retweets_manual : post.retweets,
                                replies: post.replies_manual !== null ? post.replies_manual : post.replies,
                                bookmarks: post.bookmarks_manual !== null ? post.bookmarks_manual : post.bookmarks,
                                quotes: post.quotes_manual !== null ? post.quotes_manual : post.quotes
                            }}"
                            @keydown.arrow-right="handleMetricNavigation($event, 'right')"
                            @keydown.arrow-left="handleMetricNavigation($event, 'left')"
                            @keydown.arrow-up="handleMetricNavigation($event, 'up')"
                            @keydown.arrow-down="handleMetricNavigation($event, 'down')">
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">Views</label>
                                    <input type="number" x-model.number="tempEngagement.views"
                                           data-metric-index="0"
                                           class="metric-input w-full text-sm rounded border-gray-300 shadow-sm focus:border-purple-500 focus:ring focus:ring-purple-200"
                                           placeholder="0">
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">Likes</label>
                                    <input type="number" x-model.number="tempEngagement.likes"
                                           data-metric-index="1"
                                           class="metric-input w-full text-sm rounded border-gray-300 shadow-sm focus:border-purple-500 focus:ring focus:ring-purple-200"
                                           placeholder="0">
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">Retweets</label>
                                    <input type="number" x-model.number="tempEngagement.retweets"
                                           data-metric-index="2"
                                           class="metric-input w-full text-sm rounded border-gray-300 shadow-sm focus:border-purple-500 focus:ring focus:ring-purple-200"
                                           placeholder="0">
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">Replies</label>
                                    <input type="number" x-model.number="tempEngagement.replies"
                                           data-metric-index="3"
                                           class="metric-input w-full text-sm rounded border-gray-300 shadow-sm focus:border-purple-500 focus:ring focus:ring-purple-200"
                                           placeholder="0">
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">Bookmarks</label>
                                    <input type="number" x-model.number="tempEngagement.bookmarks"
                                           data-metric-index="4"
                                           class="metric-input w-full text-sm rounded border-gray-300 shadow-sm focus:border-purple-500 focus:ring focus:ring-purple-200"
                                           placeholder="0">
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">Quotes</label>
                                    <input type="number" x-model.number="tempEngagement.quotes"
                                           data-metric-index="5"
                                           class="metric-input w-full text-sm rounded border-gray-300 shadow-sm focus:border-purple-500 focus:ring focus:ring-purple-200"
                                           placeholder="0">
                                </div>
                                <div class="col-span-2 md:col-span-3">
                                    <button @click="saveEngagementMetrics(post.id, tempEngagement)"
                                            class="w-full bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600 text-white py-2 px-4 rounded-lg font-medium transition-colors">
                                        üíæ Engagement-Metriken speichern
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- TER Scores -->
                        <div class="mb-4">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-4 rounded-lg">
                                    <div class="text-sm font-medium mb-1">TER (Automatisch)</div>
                                    <div class="text-3xl font-bold" x-text="post.ter_automatic.toFixed(2) + '%'"></div>
                                    <div class="text-xs opacity-75 mt-1">Hirsch 2025</div>
                                </div>

                                <div class="bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-lg">
                                    <div class="text-sm font-medium mb-1">Weighted Engagement</div>
                                    <div class="text-3xl font-bold" x-text="post.weighted_engagement.toLocaleString()"></div>
                                    <div class="text-xs opacity-75 mt-1" x-text="post.total_interactions.toLocaleString() + ' total interactions'"></div>
                                </div>

                                <div class="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-4 rounded-lg">
                                    <div class="text-sm font-medium mb-1">TER (Manuell)</div>
                                    <div class="text-3xl font-bold" x-text="post.ter_manual ? post.ter_manual.toFixed(2) + '%' : '--'"></div>
                                    <div class="text-xs opacity-75 mt-1">
                                        <button @click="openManualCalculator(post.id, index)"
                                                class="bg-white bg-opacity-20 hover:bg-opacity-30 px-3 py-1 rounded transition-colors">
                                            üßÆ Neu berechnen
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Manual TER Calculator (Collapsible) -->
                            <div x-show="manualCalc.postId === post.id" x-cloak
                                 x-transition:enter="transition ease-out duration-300"
                                 x-transition:enter-start="opacity-0 transform scale-95"
                                 x-transition:enter-end="opacity-100 transform scale-100"
                                 class="bg-gradient-to-br from-purple-50 to-indigo-50 border-2 border-purple-300 rounded-lg p-6 mb-4">

                                <div class="flex justify-between items-center mb-4">
                                    <h4 class="text-lg font-bold text-gray-900">üßÆ Manuelle TER-Berechnung</h4>
                                    <button @click="closeManualCalculator()" class="text-gray-500 hover:text-gray-700">
                                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                        </svg>
                                    </button>
                                </div>

                                <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4">
                                    <!-- Views -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">
                                            üëÅÔ∏è Views
                                        </label>
                                        <input type="number"
                                               x-model.number="manualCalc.values.views"
                                               @input="calculateManualTER()"
                                               class="w-full rounded-lg border-gray-300 shadow-sm focus:border-purple-500 focus:ring focus:ring-purple-200"
                                               placeholder="0">
                                    </div>

                                    <!-- Likes -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">
                                            ‚ù§Ô∏è Likes <span class="text-xs text-gray-500">(√ó1)</span>
                                        </label>
                                        <input type="number"
                                               x-model.number="manualCalc.values.likes"
                                               @input="calculateManualTER()"
                                               class="w-full rounded-lg border-gray-300 shadow-sm focus:border-purple-500 focus:ring focus:ring-purple-200"
                                               placeholder="0">
                                    </div>

                                    <!-- Bookmarks -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">
                                            üîñ Bookmarks <span class="text-xs text-gray-500">(√ó2)</span>
                                        </label>
                                        <input type="number"
                                               x-model.number="manualCalc.values.bookmarks"
                                               @input="calculateManualTER()"
                                               class="w-full rounded-lg border-gray-300 shadow-sm focus:border-purple-500 focus:ring focus:ring-purple-200"
                                               placeholder="0">
                                    </div>

                                    <!-- Replies -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">
                                            üí¨ Replies <span class="text-xs text-gray-500">(√ó3)</span>
                                        </label>
                                        <input type="number"
                                               x-model.number="manualCalc.values.replies"
                                               @input="calculateManualTER()"
                                               class="w-full rounded-lg border-gray-300 shadow-sm focus:border-purple-500 focus:ring focus:ring-purple-200"
                                               placeholder="0">
                                    </div>

                                    <!-- Retweets -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">
                                            üîÑ Retweets <span class="text-xs text-gray-500">(√ó4)</span>
                                        </label>
                                        <input type="number"
                                               x-model.number="manualCalc.values.retweets"
                                               @input="calculateManualTER()"
                                               class="w-full rounded-lg border-gray-300 shadow-sm focus:border-purple-500 focus:ring focus:ring-purple-200"
                                               placeholder="0">
                                    </div>

                                    <!-- Quotes -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">
                                            üí≠ Quotes <span class="text-xs text-gray-500">(√ó5)</span>
                                        </label>
                                        <input type="number"
                                               x-model.number="manualCalc.values.quotes"
                                               @input="calculateManualTER()"
                                               class="w-full rounded-lg border-gray-300 shadow-sm focus:border-purple-500 focus:ring focus:ring-purple-200"
                                               placeholder="0">
                                    </div>
                                </div>

                                <!-- Live Calculation Result -->
                                <div class="bg-white rounded-lg p-4 mb-4">
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center mb-4">
                                        <div>
                                            <div class="text-sm text-gray-600 mb-1">Weighted Engagement</div>
                                            <div class="text-2xl font-bold text-purple-600" x-text="manualCalc.result.weighted_engagement.toLocaleString()"></div>
                                            <div class="text-xs text-gray-500 mt-1">
                                                <span x-text="'(' + manualCalc.values.likes + '√ó1) + (' + manualCalc.values.bookmarks + '√ó2) + (' + manualCalc.values.replies + '√ó3) + (' + manualCalc.values.retweets + '√ó4) + (' + manualCalc.values.quotes + '√ó5)'"></span>
                                            </div>
                                        </div>
                                        <div>
                                            <div class="text-sm text-gray-600 mb-1">Total Interactions</div>
                                            <div class="text-2xl font-bold text-indigo-600" x-text="manualCalc.result.total_interactions.toLocaleString()"></div>
                                            <div class="text-xs text-gray-500 mt-1">Ungewichtet</div>
                                        </div>
                                        <div class="bg-gradient-to-r from-purple-500 to-indigo-500 text-white rounded-lg p-3">
                                            <div class="text-sm font-medium mb-1">TER‚àö (Hirsch 2025)</div>
                                            <div class="text-3xl font-bold" x-text="manualCalc.result.ter.toFixed(2)"></div>
                                            <div class="text-xs opacity-75 mt-1">‚àöViews-Normalisierung</div>
                                        </div>
                                    </div>

                                    <!-- Engagement Level Badge -->
                                    <div class="border-t pt-3">
                                        <div class="flex items-center justify-center">
                                            <span class="inline-flex items-center px-4 py-2 rounded-full text-sm font-semibold"
                                                  :class="{
                                                      'bg-blue-100 text-blue-800': manualCalc.result.engagement_level_code === 'low',
                                                      'bg-green-100 text-green-800': manualCalc.result.engagement_level_code === 'medium',
                                                      'bg-orange-100 text-orange-800': manualCalc.result.engagement_level_code === 'high',
                                                      'bg-red-100 text-red-800': manualCalc.result.engagement_level_code === 'very_high'
                                                  }"
                                                  x-text="manualCalc.result.engagement_level">
                                            </span>
                                        </div>
                                    </div>

                                    <!-- TER Vergleich: Linear vs. ‚àö -->
                                    <div class="mt-3 p-3 bg-gray-50 rounded-lg">
                                        <div class="text-xs text-gray-600 mb-1 text-center font-medium">Vergleich mit linearer TER</div>
                                        <div class="flex justify-center items-center space-x-4 text-sm">
                                            <div>
                                                <span class="text-gray-500">TER (alt, linear):</span>
                                                <span class="font-bold text-gray-700 ml-1" x-text="manualCalc.result.ter_linear.toFixed(2) + '%'"></span>
                                            </div>
                                            <div class="text-gray-400">‚Üí</div>
                                            <div>
                                                <span class="text-gray-500">TER‚àö (neu):</span>
                                                <span class="font-bold text-purple-600 ml-1" x-text="manualCalc.result.ter_sqrt.toFixed(2)"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Action Buttons -->
                                <div class="flex justify-between items-center">
                                    <button @click="prefillFromPost(post)"
                                            class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-lg transition-colors text-sm font-medium">
                                        ‚¨ÖÔ∏è Werte vom Post √ºbernehmen
                                    </button>
                                    <div class="flex space-x-2">
                                        <button @click="closeManualCalculator()"
                                                class="bg-gray-300 hover:bg-gray-400 text-gray-800 px-6 py-2 rounded-lg transition-colors font-medium">
                                            Abbrechen
                                        </button>
                                        <button @click="saveManualTER(post.id)"
                                                class="bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600 text-white px-6 py-2 rounded-lg transition-colors font-medium">
                                            üíæ TER speichern
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Notes & Actions -->
                        <div class="border-t pt-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Notizen</label>
                            <textarea :value="post.notes"
                                      @blur="updateNotes(post.id, $event.target.value)"
                                      rows="2"
                                      placeholder="Deine Notizen zu diesem Post..."
                                      class="w-full rounded-lg border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-sm"></textarea>

                            <div class="flex justify-between items-center mt-3">
                                <div class="flex items-center space-x-4">
                                    <a :href="post.factcheck_url" target="_blank" class="text-sm text-primary hover:underline">
                                        üìÑ Zum Factcheck-Artikel
                                    </a>

                                    <!-- Archive Toggle -->
                                    <label class="flex items-center space-x-2 cursor-pointer group">
                                        <span class="text-sm font-medium text-gray-700 group-hover:text-gray-900">üì¶ Archivieren</span>
                                        <div class="relative">
                                            <input type="checkbox"
                                                   :checked="post.is_archived"
                                                   @change="toggleArchive(post.id, $event.target.checked)"
                                                   class="sr-only peer">
                                            <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-2 peer-focus:ring-red-300 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-500"></div>
                                        </div>
                                        <span class="text-xs text-gray-500">(Post nicht mehr verf√ºgbar)</span>
                                    </label>

                                    <!-- Favorite Toggle -->
                                    <label class="flex items-center space-x-2 cursor-pointer group">
                                        <span class="text-sm font-medium text-gray-700 group-hover:text-gray-900">‚≠ê Favorit</span>
                                        <div class="relative">
                                            <input type="checkbox"
                                                   :checked="post.is_favorite"
                                                   @change="toggleFavorite(post.id, $event.target.checked)"
                                                   class="sr-only peer">
                                            <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-2 peer-focus:ring-yellow-300 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-yellow-500"></div>
                                        </div>
                                        <span class="text-xs text-gray-500">(Session-√ºbergreifend)</span>
                                    </label>
                                </div>

                                <button @click="toggleReviewed(post.id, !post.is_reviewed)"
                                        :class="post.is_reviewed ? 'bg-gray-300 text-gray-700' : 'bg-success text-white'"
                                        class="px-4 py-2 rounded-lg hover:opacity-80 transition-colors text-sm font-medium">
                                    <span x-show="!post.is_reviewed">‚úì Als reviewed markieren</span>
                                    <span x-show="post.is_reviewed">‚Üª Als unreviewed markieren</span>
                                </button>
                            </div>
                        </div>

                    </div>
                </template>

                <!-- Pagination Controls -->
                <div x-show="!loading && posts.length > pagination.itemsPerPage" class="mt-6 flex items-center justify-between bg-white rounded-lg shadow-md p-4">
                    <div class="text-sm text-gray-600">
                        Zeige <span class="font-medium" x-text="((pagination.currentPage - 1) * pagination.itemsPerPage) + 1"></span>
                        bis <span class="font-medium" x-text="Math.min(pagination.currentPage * pagination.itemsPerPage, posts.length)"></span>
                        von <span class="font-medium" x-text="posts.length"></span> Posts
                    </div>

                    <div class="flex items-center space-x-2">
                        <!-- Previous Button -->
                        <button @click="prevPage()"
                                :disabled="pagination.currentPage === 1"
                                :class="pagination.currentPage === 1 ? 'opacity-50 cursor-not-allowed' : 'hover:bg-gray-100'"
                                class="px-4 py-2 bg-white border border-gray-300 rounded-lg text-sm font-medium text-gray-700 transition-colors">
                            ‚Üê Zur√ºck
                        </button>

                        <!-- Page Numbers -->
                        <template x-for="page in totalPages" :key="page">
                            <button x-show="page === 1 || page === totalPages || (page >= pagination.currentPage - 1 && page <= pagination.currentPage + 1)"
                                    @click="goToPage(page)"
                                    :class="pagination.currentPage === page ? 'bg-primary text-white' : 'bg-white text-gray-700 hover:bg-gray-100'"
                                    class="px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium transition-colors"
                                    x-text="page">
                            </button>
                        </template>

                        <!-- Next Button -->
                        <button @click="nextPage()"
                                :disabled="pagination.currentPage === totalPages"
                                :class="pagination.currentPage === totalPages ? 'opacity-50 cursor-not-allowed' : 'hover:bg-gray-100'"
                                class="px-4 py-2 bg-white border border-gray-300 rounded-lg text-sm font-medium text-gray-700 transition-colors">
                            Weiter ‚Üí
                        </button>
                    </div>
                </div>

            </div>

            <!-- ===== REVIEWED POSTS TAB ===== -->
            <div x-show="currentTab === 'reviewed'" class="fade-in">

                <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-900">‚úÖ Reviewed Posts √úbersicht</h2>
                            <p class="text-gray-600 mt-1">Alle Posts mit manuellen TER-Berechnungen</p>
                        </div>
                        <div class="text-right">
                            <div class="text-3xl font-bold text-green-600" x-text="reviewedPosts.length"></div>
                            <div class="text-sm text-gray-500">Reviewed</div>
                        </div>
                    </div>

                    <!-- Sort Options and Export -->
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center space-x-4">
                            <label class="text-sm font-medium text-gray-700">Sortierung:</label>
                            <select @change="sortReviewedPosts()" x-model="reviewedSort" class="rounded-lg border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50">
                                <option value="ter_manual_desc">TER (H√∂chste zuerst)</option>
                                <option value="ter_manual_asc">TER (Niedrigste zuerst)</option>
                                <option value="date_desc">Datum (Neueste zuerst)</option>
                                <option value="views_desc">Views (H√∂chste zuerst)</option>
                                <option value="followers_desc">Followers (H√∂chste zuerst)</option>
                            </select>
                        </div>

                        <!-- Export Buttons -->
                        <div class="flex items-center space-x-3">
                            <!-- CSV Export Button -->
                            <button @click="exportReviewedPostsCSV()"
                                    class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-blue-600 to-blue-700 text-white font-semibold rounded-lg hover:from-blue-700 hover:to-blue-800 transition-all shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                </svg>
                                CSV Export
                            </button>

                            <!-- PDF Export Button -->
                            <button @click="exportReviewedPostsPDF()"
                                    class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-red-600 to-red-700 text-white font-semibold rounded-lg hover:from-red-700 hover:to-red-800 transition-all shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                </svg>
                                PDF Export
                            </button>

                            <!-- Excel Export Button -->
                            <button @click="exportReviewedPostsExcel()"
                                    class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-green-600 to-green-700 text-white font-semibold rounded-lg hover:from-green-700 hover:to-green-800 transition-all shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                </svg>
                                Excel Export
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Reviewed Posts Table -->
                <div class="bg-white rounded-lg shadow-md overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gradient-to-r from-green-500 to-green-600 text-white">
                                <tr>
                                    <th class="px-4 py-3 text-left text-sm font-semibold">#</th>
                                    <th class="px-4 py-3 text-left text-sm font-semibold">Post Info</th>
                                    <th class="px-4 py-3 text-left text-sm font-semibold">Content</th>
                                    <th class="px-4 py-3 text-center text-sm font-semibold">TER‚àö (Hirsch 2025)<br><span class="text-xs font-normal opacity-90">Engagement-Level</span></th>
                                    <th class="px-4 py-3 text-center text-sm font-semibold">TER Manuell</th>
                                    <th class="px-4 py-3 text-center text-sm font-semibold">TER (linear alt)</th>
                                    <th class="px-4 py-3 text-right text-sm font-semibold">Engagement</th>
                                    <th class="px-4 py-3 text-center text-sm font-semibold">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                <template x-for="(post, index) in reviewedPosts" :key="post.id">
                                    <tr class="hover:bg-gray-50 transition-colors">
                                        <!-- Index -->
                                        <td class="px-4 py-4 text-sm font-semibold text-gray-700" x-text="index + 1"></td>

                                        <!-- Post Info -->
                                        <td class="px-4 py-4">
                                            <div class="text-sm">
                                                <div class="font-medium text-gray-900" x-text="'@' + post.twitter_handle"></div>
                                                <div class="text-xs text-gray-500" x-text="post.twitter_followers.toLocaleString() + ' Followers'"></div>
                                                <div class="text-xs text-gray-400 mt-1" x-text="post.twitter_date"></div>
                                            </div>
                                        </td>

                                        <!-- Content Preview -->
                                        <td class="px-4 py-4 max-w-xs">
                                            <div class="text-sm text-gray-700 line-clamp-2" x-text="post.twitter_content"></div>
                                            <div class="text-xs text-gray-400 mt-1 truncate">
                                                <a :href="post.factcheck_url" target="_blank" class="hover:underline">
                                                    <span x-text="post.factcheck_title"></span>
                                                </a>
                                            </div>
                                        </td>

                                        <!-- TER‚àö (Hirsch 2025) mit Engagement Level -->
                                        <td class="px-4 py-4 text-center">
                                            <div class="inline-flex flex-col items-center">
                                                <span class="text-lg font-bold text-purple-600" x-text="post.ter_automatic.toFixed(2)"></span>
                                                <span class="text-xs text-gray-500 mb-2">‚àöViews-Norm.</span>
                                                <!-- Engagement Level Badge -->
                                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-semibold"
                                                      :class="{
                                                          'bg-blue-100 text-blue-800': post.engagement_level_code === 'low',
                                                          'bg-green-100 text-green-800': post.engagement_level_code === 'medium',
                                                          'bg-orange-100 text-orange-800': post.engagement_level_code === 'high',
                                                          'bg-red-100 text-red-800': post.engagement_level_code === 'very_high'
                                                      }"
                                                      :title="post.engagement_level">
                                                    <span x-show="post.engagement_level_code === 'low'">Niedrig</span>
                                                    <span x-show="post.engagement_level_code === 'medium'">Mittel</span>
                                                    <span x-show="post.engagement_level_code === 'high'">Hoch</span>
                                                    <span x-show="post.engagement_level_code === 'very_high'">Sehr hoch</span>
                                                </span>
                                            </div>
                                        </td>

                                        <!-- TER Manual -->
                                        <td class="px-4 py-4 text-center">
                                            <div class="inline-flex flex-col items-center">
                                                <span class="text-lg font-bold text-indigo-600" x-text="post.ter_manual ? post.ter_manual.toFixed(2) : '--'"></span>
                                                <span class="text-xs text-gray-500">Manuell korr.</span>
                                            </div>
                                        </td>

                                        <!-- TER Linear (alt) -->
                                        <td class="px-4 py-4 text-center">
                                            <div class="inline-flex flex-col items-center">
                                                <span class="text-sm font-medium text-gray-600" x-text="post.ter_linear ? post.ter_linear.toFixed(2) + '%' : '--'"></span>
                                                <span class="text-xs text-gray-400">Vergleich</span>
                                            </div>
                                        </td>

                                        <!-- Engagement Stats -->
                                        <td class="px-4 py-4 text-right">
                                            <div class="text-sm space-y-1">
                                                <div class="text-gray-700">
                                                    <span class="font-medium" x-text="(post.views_manual !== null ? post.views_manual : post.views).toLocaleString()"></span>
                                                    <span class="text-xs text-gray-500">Views</span>
                                                    <span x-show="post.views_manual !== null" class="text-xs text-purple-600 ml-1" title="Manuell eingegeben">‚úì</span>
                                                </div>
                                                <div class="text-gray-600 text-xs">
                                                    <span x-text="(post.likes_manual !== null ? post.likes_manual : post.likes).toLocaleString()"></span> ‚ù§Ô∏è |
                                                    <span x-text="(post.retweets_manual !== null ? post.retweets_manual : post.retweets).toLocaleString()"></span> üîÑ |
                                                    <span x-text="(post.replies_manual !== null ? post.replies_manual : post.replies).toLocaleString()"></span> üí¨
                                                </div>
                                                <div class="text-gray-600 text-xs">
                                                    <span x-text="(post.bookmarks_manual !== null ? post.bookmarks_manual : post.bookmarks).toLocaleString()"></span> üîñ |
                                                    <span x-text="(post.quotes_manual !== null ? post.quotes_manual : post.quotes).toLocaleString()"></span> üí≠
                                                </div>
                                            </div>
                                        </td>

                                        <!-- Actions -->
                                        <td class="px-4 py-4 text-center">
                                            <div class="flex items-center justify-center space-x-2">
                                                <button @click="openTwitterUrl(post.twitter_url)"
                                                        class="bg-twitter text-white p-2 rounded-lg hover:bg-blue-600 transition-colors"
                                                        title="Post √∂ffnen">
                                                    üê¶
                                                </button>
                                                <button @click="viewPostDetails(post)"
                                                        class="bg-primary text-white p-2 rounded-lg hover:bg-blue-600 transition-colors"
                                                        title="Details anzeigen">
                                                    üëÅÔ∏è
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>

                    <!-- Empty State -->
                    <div x-show="reviewedPosts.length === 0" class="text-center py-12">
                        <svg class="h-16 w-16 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <p class="text-gray-500 text-lg">Noch keine reviewed Posts</p>
                        <p class="text-sm text-gray-400 mt-2">Gehe zu "Review Posts" und markiere Posts als reviewed</p>
                    </div>
                </div>

                <!-- Summary Statistics -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6">
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <h3 class="text-sm font-medium text-gray-700 mb-3">üìä TER Vergleich</h3>
                        <div class="space-y-2">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">√ò TER Automatisch:</span>
                                <span class="font-semibold text-blue-600" x-text="calculateAvgAutoTER() + '%'"></span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">√ò TER Manuell:</span>
                                <span class="font-semibold text-purple-600" x-text="calculateAvgManualTER() + '%'"></span>
                            </div>
                            <div class="flex justify-between text-sm pt-2 border-t">
                                <span class="text-gray-600">Durchschn. Differenz:</span>
                                <span class="font-semibold" :class="calculateAvgDifference() > 0 ? 'text-green-600' : 'text-red-600'"
                                      x-text="(calculateAvgDifference() > 0 ? '+' : '') + calculateAvgDifference() + '%'"></span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow-md p-6">
                        <h3 class="text-sm font-medium text-gray-700 mb-3">üéØ Posts mit manueller Berechnung</h3>
                        <div class="space-y-2">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Mit TER Manuell:</span>
                                <span class="font-semibold text-green-600" x-text="reviewedPostsWithManualTER().length"></span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Ohne TER Manuell:</span>
                                <span class="font-semibold text-yellow-600" x-text="reviewedPosts.length - reviewedPostsWithManualTER().length"></span>
                            </div>
                            <div class="flex justify-between text-sm pt-2 border-t">
                                <span class="text-gray-600">Abdeckung:</span>
                                <span class="font-semibold text-primary" x-text="reviewedPosts.length > 0 ? ((reviewedPostsWithManualTER().length / reviewedPosts.length) * 100).toFixed(0) + '%' : '0%'"></span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow-md p-6">
                        <h3 class="text-sm font-medium text-gray-700 mb-3">üìà Engagement</h3>
                        <div class="space-y-2">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Gesamt Views:</span>
                                <span class="font-semibold text-blue-600" x-text="calculateTotalViews().toLocaleString()"></span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">√ò Followers:</span>
                                <span class="font-semibold text-purple-600" x-text="calculateAvgFollowers().toLocaleString()"></span>
                            </div>
                            <div class="flex justify-between text-sm pt-2 border-t">
                                <span class="text-gray-600">Total Interactions:</span>
                                <span class="font-semibold text-green-600" x-text="calculateTotalInteractions().toLocaleString()"></span>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <!-- ===== STATISTICS TAB ===== -->
            <div x-show="currentTab === 'statistics'" class="fade-in">

                <!-- Info Banner -->
                <div class="bg-green-50 border-l-4 border-green-500 p-4 mb-6">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm text-green-700">
                                <strong>Hinweis:</strong> Alle Statistiken basieren ausschlie√ülich auf <strong>reviewed Posts</strong>. Nicht-reviewed Posts werden hier nicht ber√ºcksichtigt.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Overview Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-lg shadow-lg p-6 card-hover">
                        <div class="text-sm font-medium mb-2">Durchschnittlicher TER‚àö (Manuell)</div>
                        <div class="text-4xl font-bold" x-text="(statistics.ter_manual?.mean || 0).toFixed(2)"></div>
                        <div class="text-xs opacity-75 mt-2">Median: <span x-text="(statistics.ter_manual?.median || 0).toFixed(2)"></span></div>
                    </div>

                    <div class="bg-gradient-to-br from-green-500 to-green-600 text-white rounded-lg shadow-lg p-6 card-hover">
                        <div class="text-sm font-medium mb-2">Durchschnittliche Views</div>
                        <div class="text-4xl font-bold" x-text="(statistics.views?.mean || 0).toLocaleString()"></div>
                        <div class="text-xs opacity-75 mt-2">Total: <span x-text="(statistics.views?.sum || 0).toLocaleString()"></span></div>
                    </div>

                    <div class="bg-gradient-to-br from-purple-500 to-purple-600 text-white rounded-lg shadow-lg p-6 card-hover">
                        <div class="text-sm font-medium mb-2">Durchschnittliche Followers</div>
                        <div class="text-4xl font-bold" x-text="(statistics.followers?.mean || 0).toLocaleString()"></div>
                        <div class="text-xs opacity-75 mt-2">Max: <span x-text="(statistics.followers?.max || 0).toLocaleString()"></span></div>
                    </div>

                    <div class="bg-gradient-to-br from-red-500 to-red-600 text-white rounded-lg shadow-lg p-6 card-hover">
                        <div class="text-sm font-medium mb-2">H√∂chster TER‚àö (Manuell)</div>
                        <div class="text-4xl font-bold" x-text="(statistics.ter_manual?.max || 0).toFixed(2)"></div>
                        <div class="text-xs opacity-75 mt-2">Niedrigster: <span x-text="(statistics.ter_manual?.min || 0).toFixed(2)"></span></div>
                    </div>
                </div>

                <!-- TER‚àö Interpretations-Legende -->
                <div class="bg-gradient-to-r from-purple-50 to-indigo-50 border-l-4 border-purple-500 rounded-lg p-6 mb-8">
                    <h3 class="text-xl font-bold text-gray-900 mb-4">üéØ TER‚àö Interpretationstabelle (Hirsch 2025)</h3>
                    <p class="text-sm text-gray-600 mb-4">Die neue TER‚àö-Formel verwendet ‚àöViews-Normalisierung f√ºr realistischere Engagement-Bewertung</p>

                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead>
                                <tr class="border-b-2 border-purple-300">
                                    <th class="px-4 py-3 text-left font-semibold text-gray-700">TER‚àö-Wert</th>
                                    <th class="px-4 py-3 text-left font-semibold text-gray-700">Interpretation</th>
                                    <th class="px-4 py-3 text-left font-semibold text-gray-700">Psychologische Bedeutung</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                <tr class="hover:bg-white/50 transition-colors">
                                    <td class="px-4 py-3">
                                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-blue-100 text-blue-800">
                                            &lt; 5
                                        </span>
                                    </td>
                                    <td class="px-4 py-3 font-medium text-gray-900">Niedrig</td>
                                    <td class="px-4 py-3 text-gray-600">Passive Rezeption, kaum Aktivierung</td>
                                </tr>
                                <tr class="hover:bg-white/50 transition-colors">
                                    <td class="px-4 py-3">
                                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800">
                                            5 ‚Äì 10
                                        </span>
                                    </td>
                                    <td class="px-4 py-3 font-medium text-gray-900">Mittel</td>
                                    <td class="px-4 py-3 text-gray-600">Moderate Aufmerksamkeit, normale Aktivierung</td>
                                </tr>
                                <tr class="hover:bg-white/50 transition-colors">
                                    <td class="px-4 py-3">
                                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-orange-100 text-orange-800">
                                            10 ‚Äì 15
                                        </span>
                                    </td>
                                    <td class="px-4 py-3 font-medium text-gray-900">Hoch</td>
                                    <td class="px-4 py-3 text-gray-600">Starke emotionale Beteiligung</td>
                                </tr>
                                <tr class="hover:bg-white/50 transition-colors">
                                    <td class="px-4 py-3">
                                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-800">
                                            &gt; 15
                                        </span>
                                    </td>
                                    <td class="px-4 py-3 font-medium text-gray-900">Sehr hoch</td>
                                    <td class="px-4 py-3 text-gray-600">Virale Dynamik, maximale Involvierung</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="mt-4 p-3 bg-white/50 rounded-lg">
                        <p class="text-xs text-gray-600">
                            <strong>Formel:</strong> TER‚àö = Weighted Engagement / ‚àöViews
                            <br>
                            <strong>Gewichtung:</strong> Likes √ó1, Bookmarks √ó2, Replies √ó3, Retweets √ó4, Quotes √ó5
                        </p>
                    </div>
                </div>

                <!-- Detailed Statistics -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">

                    <!-- TER Statistics -->
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h3 class="text-xl font-bold mb-4 text-gray-900">üìä TER‚àö Statistiken (Hirsch 2025)</h3>
                        <table class="w-full text-sm">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-2 text-left text-gray-700">Metrik</th>
                                    <th class="px-4 py-2 text-right text-gray-700">Wert</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                <tr>
                                    <td class="px-4 py-2 text-gray-600">Anzahl Posts</td>
                                    <td class="px-4 py-2 text-right font-medium" x-text="statistics.ter_manual?.count || 0"></td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-2 text-gray-600">Mittelwert</td>
                                    <td class="px-4 py-2 text-right font-medium" x-text="(statistics.ter_manual?.mean || 0).toFixed(2)"></td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-2 text-gray-600">Median</td>
                                    <td class="px-4 py-2 text-right font-medium" x-text="(statistics.ter_manual?.median || 0).toFixed(2)"></td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-2 text-gray-600">Standardabweichung</td>
                                    <td class="px-4 py-2 text-right font-medium" x-text="(statistics.ter_manual?.stdev || 0).toFixed(2)"></td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-2 text-gray-600">Minimum</td>
                                    <td class="px-4 py-2 text-right font-medium" x-text="(statistics.ter_manual?.min || 0).toFixed(2)"></td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-2 text-gray-600">Maximum</td>
                                    <td class="px-4 py-2 text-right font-medium" x-text="(statistics.ter_manual?.max || 0).toFixed(2)"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Engagement Statistics -->
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h3 class="text-xl font-bold mb-4 text-gray-900">üí¨ Engagement Statistiken</h3>
                        <table class="w-full text-sm">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-2 text-left text-gray-700">Metrik</th>
                                    <th class="px-4 py-2 text-right text-gray-700">Durchschnitt</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                <tr>
                                    <td class="px-4 py-2 text-gray-600">üëÅÔ∏è Views</td>
                                    <td class="px-4 py-2 text-right font-medium" x-text="(statistics.views?.mean || 0).toLocaleString()"></td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-2 text-gray-600">‚ù§Ô∏è Likes</td>
                                    <td class="px-4 py-2 text-right font-medium" x-text="(statistics.likes?.mean || 0).toLocaleString()"></td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-2 text-gray-600">üîÑ Retweets</td>
                                    <td class="px-4 py-2 text-right font-medium" x-text="(statistics.retweets?.mean || 0).toLocaleString()"></td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-2 text-gray-600">üí¨ Replies</td>
                                    <td class="px-4 py-2 text-right font-medium" x-text="(statistics.replies?.mean || 0).toLocaleString()"></td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-2 text-gray-600">üë• Followers</td>
                                    <td class="px-4 py-2 text-right font-medium" x-text="(statistics.followers?.mean || 0).toLocaleString()"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Timeline Charts -->
                <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold text-gray-900">üìà Zeitlicher Verlauf</h3>
                        <div class="flex space-x-2">
                            <button @click="timelineView = 'monthly'; renderTimelineCharts()"
                                    :class="timelineView === 'monthly' ? 'bg-primary text-white' : 'bg-gray-200 text-gray-700'"
                                    class="px-4 py-2 rounded-lg text-sm font-medium transition-colors hover:opacity-80">
                                Monatlich
                            </button>
                            <button @click="timelineView = 'yearly'; renderTimelineCharts()"
                                    :class="timelineView === 'yearly' ? 'bg-primary text-white' : 'bg-gray-200 text-gray-700'"
                                    class="px-4 py-2 rounded-lg text-sm font-medium transition-colors hover:opacity-80">
                                J√§hrlich
                            </button>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Post Count Chart -->
                        <div>
                            <h4 class="text-sm font-medium text-gray-700 mb-3">Anzahl Posts √ºber Zeit</h4>
                            <div class="bg-gray-50 rounded-lg p-4">
                                <canvas id="postCountChart"></canvas>
                            </div>
                        </div>

                        <!-- TER Chart -->
                        <div>
                            <h4 class="text-sm font-medium text-gray-700 mb-3">Durchschnittlicher TER (Manuell) √ºber Zeit</h4>
                            <div class="bg-gray-50 rounded-lg p-4">
                                <canvas id="terTimelineChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Info Text -->
                    <div class="mt-4 text-xs text-gray-500 text-center">
                        <p>Basiert auf dem Twitter-Datum der Posts. Nur reviewed Posts mit manuellem TER werden ber√ºcksichtigt.</p>
                    </div>
                </div>

                <!-- Top Posts -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold text-gray-900">üèÜ Top 10 Reviewed Posts (nach TER Manuell)</h3>
                        <span class="text-sm text-green-600 font-medium">Nur reviewed Posts mit manuellem TER</span>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-2 text-left text-gray-700">#</th>
                                    <th class="px-4 py-2 text-left text-gray-700">Author</th>
                                    <th class="px-4 py-2 text-left text-gray-700">Content</th>
                                    <th class="px-4 py-2 text-right text-gray-700">TER (Manuell)</th>
                                    <th class="px-4 py-2 text-right text-gray-700">Views</th>
                                    <th class="px-4 py-2 text-right text-gray-700">Followers</th>
                                    <th class="px-4 py-2 text-center text-gray-700">Action</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                <template x-for="(post, index) in statistics.top_posts" :key="post.id">
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-4 py-3 font-medium text-gray-900" x-text="index + 1"></td>
                                        <td class="px-4 py-3">
                                            <div class="font-medium text-gray-900" x-text="post.twitter_author"></div>
                                            <div class="text-xs text-gray-500" x-text="'@' + post.twitter_handle"></div>
                                        </td>
                                        <td class="px-4 py-3 max-w-xs">
                                            <div class="truncate text-gray-600" x-text="post.twitter_content"></div>
                                        </td>
                                        <td class="px-4 py-3 text-right">
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800" x-text="post.ter_manual ? post.ter_manual.toFixed(2) + '%' : '--'"></span>
                                        </td>
                                        <td class="px-4 py-3 text-right font-medium text-gray-900" x-text="post.views.toLocaleString()"></td>
                                        <td class="px-4 py-3 text-right font-medium text-gray-900" x-text="post.twitter_followers.toLocaleString()"></td>
                                        <td class="px-4 py-3 text-center">
                                            <button @click="openTwitterUrl(post.twitter_url)" class="text-twitter hover:text-blue-600">
                                                üê¶
                                            </button>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>

            <!-- Trigger & Frames Tab -->
            <div x-show="currentTab === 'triggers'" class="fade-in">

                <!-- Header Info -->
                <div class="bg-gradient-to-r from-purple-50 to-indigo-50 border-l-4 border-purple-500 p-6 mb-6 rounded-lg">
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">üß† Qualitative Analyse: Trigger & Frames</h2>
                    <p class="text-sm text-gray-700 mb-4">
                        Codiere emotionale Trigger (Intensit√§t 0-5) und thematische Frames (bin√§r 0-1) f√ºr alle <strong>reviewed Posts</strong>.
                    </p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-xs">
                        <div class="bg-white p-3 rounded border">
                            <h4 class="font-bold mb-2">üìä Emotionale Trigger (0-5)</h4>
                            <ul class="space-y-1 text-gray-700">
                                <li><strong>Angst/Bedrohung:</strong> Schutzreflexe, defensive Einstellungen</li>
                                <li><strong>Wut:</strong> √Ñrger, Frustration, aggressive Emotionen</li>
                                <li><strong>Emp√∂rung:</strong> Moralische Verurteilung, hohe Aktivierung</li>
                                <li><strong>Ekel:</strong> Abwertung, Entmenschlichung</li>
                                <li><strong>Identit√§tsbezug:</strong> "Wir vs. Sie"-Dynamik, Polarisierung</li>
                                <li><strong>Hoffnung/Stolz:</strong> Positive Mobilisierung</li>
                            </ul>
                        </div>
                        <div class="bg-white p-3 rounded border">
                            <h4 class="font-bold mb-2">üß© Thematische Frames (0-1)</h4>
                            <ul class="space-y-1 text-gray-700">
                                <li><strong>Opfer-T√§ter:</strong> Schuldzuweisungen, moralische Bewertungen</li>
                                <li><strong>Bedrohung:</strong> Externe Gefahr, "Angriff", "bedroht"</li>
                                <li><strong>Verschw√∂rung:</strong> Geheime M√§chte, "System", "Eliten"</li>
                                <li><strong>Moral:</strong> Gut-B√∂se-Dichotomie</li>
                                <li><strong>Historisch:</strong> Bezug auf Geschichte, Tradition</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- CSV Import Bereich f√ºr Trigger & Frames -->
                <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                    <div class="flex items-center mb-4">
                        <svg class="w-6 h-6 text-purple-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                        </svg>
                        <h3 class="text-lg font-bold text-gray-900">üìÅ Trigger & Frames CSV Import</h3>
                    </div>

                    <p class="text-sm text-gray-600 mb-4">
                        Importiere eine CSV-Datei mit Trigger- und Frame-Codierungen. Die Datei wird automatisch zu den bestehenden Posts gematcht (via <code class="bg-gray-100 px-2 py-1 rounded text-xs">twitter_url</code>).
                    </p>

                    <!-- CSV Format Info -->
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                        <h4 class="font-semibold text-blue-900 mb-2">üìã Erforderliches Dateiformat:</h4>
                        <div class="text-xs text-blue-800 font-mono bg-white p-3 rounded border border-blue-200 overflow-x-auto">
                            <code>twitter_url,trigger_angst,trigger_wut,trigger_empoerung,trigger_ekel,trigger_identitaet,trigger_hoffnung,frame_opfer_taeter,frame_bedrohung,frame_verschwoerung,frame_moral,frame_historisch</code>
                        </div>
                        <ul class="text-sm text-blue-800 mt-3 space-y-1">
                            <li><strong>Formate:</strong> CSV (Komma-getrennt) oder TXT (Tab-getrennt)</li>
                            <li><strong>twitter_url:</strong> Pflichtfeld zum Matching mit bestehenden Posts</li>
                            <li><strong>Trigger (0-5):</strong> trigger_angst, trigger_wut, trigger_empoerung, trigger_ekel, trigger_identitaet, trigger_hoffnung</li>
                            <li><strong>Frames (0-1):</strong> frame_opfer_taeter, frame_bedrohung, frame_verschwoerung, frame_moral, frame_historisch</li>
                        </ul>
                    </div>

                    <!-- Upload Form -->
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-purple-400 transition-colors">
                        <input type="file"
                               id="triggersFramesFile"
                               accept=".csv,.txt"
                               class="hidden"
                               @change="handleTriggersFramesUpload($event)">

                        <label for="triggersFramesFile" class="cursor-pointer">
                            <div class="flex flex-col items-center">
                                <svg class="w-12 h-12 text-gray-400 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                                <p class="text-sm text-gray-600 mb-2">
                                    <span class="text-purple-600 font-semibold hover:text-purple-700">CSV-Datei ausw√§hlen</span>
                                    oder hierher ziehen
                                </p>
                                <p class="text-xs text-gray-500">CSV oder TXT Dateien erlaubt</p>
                            </div>
                        </label>
                    </div>

                    <!-- Upload Status -->
                    <div x-show="triggersFramesUploadStatus.message"
                         class="mt-4 p-4 rounded-lg"
                         :class="{
                            'bg-green-50 border border-green-200 text-green-800': triggersFramesUploadStatus.success,
                            'bg-red-50 border border-red-200 text-red-800': !triggersFramesUploadStatus.success
                         }">
                        <p class="text-sm font-medium" x-text="triggersFramesUploadStatus.message"></p>
                        <p x-show="triggersFramesUploadStatus.matched !== null"
                           class="text-xs mt-2">
                            ‚úì <span x-text="triggersFramesUploadStatus.matched"></span> Posts aktualisiert,
                            ‚úó <span x-text="triggersFramesUploadStatus.not_matched"></span> nicht gefunden
                        </p>
                    </div>
                </div>

                <!-- Reviewed Posts Table -->
                <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                    <div class="bg-gradient-to-r from-purple-500 to-indigo-600 text-white px-6 py-4">
                        <h3 class="text-xl font-bold">üìã Reviewed Posts - Trigger & Frame Codierung</h3>
                        <p class="text-sm text-purple-100 mt-1">Nur Posts mit is_reviewed=true</p>
                    </div>

                    <div class="p-6">
                        <!-- Filter & Stats -->
                        <div class="mb-4 flex justify-between items-center">
                            <div class="text-sm text-gray-600">
                                <span class="font-bold text-gray-900" x-text="reviewedPosts.length"></span> reviewed Posts gefunden
                            </div>
                        </div>

                        <!-- Empty State -->
                        <div x-show="reviewedPosts.length === 0" class="text-center py-12">
                            <p class="text-gray-500 text-lg">Keine reviewed Posts vorhanden</p>
                            <p class="text-sm text-gray-400 mt-2">Gehe zum "Review Posts" Tab und markiere Posts als reviewed</p>
                        </div>

                        <!-- Posts Table -->
                        <div x-show="reviewedPosts.length > 0" class="space-y-6">
                            <template x-for="(post, index) in reviewedPosts" :key="post.id">
                                <div class="border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow"
                                     x-data="{
                                        triggers: {
                                            angst: post.trigger_angst || 0,
                                            wut: post.trigger_wut || 0,
                                            empoerung: post.trigger_empoerung || 0,
                                            ekel: post.trigger_ekel || 0,
                                            identitaet: post.trigger_identitaet || 0,
                                            hoffnung: post.trigger_hoffnung || 0
                                        },
                                        frames: {
                                            opfer_taeter: (post.frame_opfer_taeter === 1 || post.frame_opfer_taeter === '1'),
                                            bedrohung: (post.frame_bedrohung === 1 || post.frame_bedrohung === '1'),
                                            verschwoerung: (post.frame_verschwoerung === 1 || post.frame_verschwoerung === '1'),
                                            moral: (post.frame_moral === 1 || post.frame_moral === '1'),
                                            historisch: (post.frame_historisch === 1 || post.frame_historisch === '1')
                                        },
                                        clampValue(field) {
                                            if (this.triggers[field] < 0) this.triggers[field] = 0;
                                            if (this.triggers[field] > 5) this.triggers[field] = 5;
                                        },
                                        showPreview: false
                                    }">

                                    <!-- Post Header -->
                                    <div class="mb-4 pb-4 border-b border-gray-200">
                                        <div class="flex justify-between items-start mb-2">
                                            <div class="flex-1">
                                                <h4 class="font-bold text-gray-900 mb-1" x-text="post.factcheck_title || 'Kein Titel'"></h4>
                                                <div class="flex items-center space-x-4 text-sm text-gray-600">
                                                    <span class="flex items-center">
                                                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20"><path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/><path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/></svg>
                                                        <span x-text="post.twitter_date"></span>
                                                    </span>
                                                    <span>@<span x-text="post.twitter_handle"></span></span>
                                                    <span class="font-bold text-purple-600">TER: <span x-text="post.ter_manual !== null ? post.ter_manual.toFixed(2) + '%' : (post.ter_automatic ? post.ter_automatic.toFixed(2) + '%' : 'N/A')"></span></span>
                                                </div>
                                            </div>
                                            <div class="ml-4 flex space-x-2">
                                                <a :href="post.twitter_url" target="_blank"
                                                   class="px-3 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600 transition-colors">
                                                    üê¶ √ñffnen
                                                </a>
                                                <button @click="showPreview = !showPreview"
                                                        :class="showPreview ? 'bg-green-500' : 'bg-indigo-500'"
                                                        class="px-3 py-1 text-white text-xs rounded hover:opacity-90 transition-colors">
                                                    <span x-text="showPreview ? 'üîº Vorschau' : 'üëÅÔ∏è Vorschau'"></span>
                                                </button>
                                            </div>
                                        </div>
                                        <p class="text-sm text-gray-700 line-clamp-3" x-text="post.twitter_content"></p>
                                    </div>

                                    <!-- Live Preview (Collapsible) -->
                                    <div x-show="showPreview" x-cloak
                                         x-transition:enter="transition ease-out duration-300"
                                         x-transition:enter-start="opacity-0 transform scale-95"
                                         x-transition:enter-end="opacity-100 transform scale-100"
                                         class="bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-300 rounded-lg p-4 mb-4">

                                        <div class="flex justify-between items-center mb-3">
                                            <h4 class="text-lg font-bold text-gray-900">üëÅÔ∏è Live-Vorschau</h4>
                                            <button @click="showPreview = false" class="text-gray-500 hover:text-gray-700">
                                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                                </svg>
                                            </button>
                                        </div>

                                        <div class="bg-white rounded-lg shadow-inner p-2">
                                            <iframe :src="post.twitter_url"
                                                    class="w-full rounded border-0"
                                                    style="min-height: 600px; height: 80vh;"
                                                    sandbox="allow-same-origin allow-scripts allow-popups allow-forms"
                                                    loading="lazy">
                                            </iframe>
                                        </div>

                                        <div class="mt-3 text-xs text-gray-600 bg-white rounded p-2">
                                            <strong>Tipp:</strong> Nutze diese Vorschau, um den Post-Inhalt direkt zu analysieren und Trigger/Frames einfacher zu codieren.
                                        </div>
                                    </div>

                                    <!-- Trigger Section -->
                                    <div class="mb-4">
                                        <h5 class="text-sm font-bold text-gray-800 mb-3 flex items-center">
                                            <span class="text-lg mr-2">üìä</span> Emotionale Trigger (Intensit√§t 0-5)
                                        </h5>
                                        <div class="grid grid-cols-1 md:grid-cols-6 gap-3">
                                            <div>
                                                <label class="block text-xs font-medium text-gray-700 mb-1">Angst/Bedrohung</label>
                                                <input type="number" min="0" max="5" x-model.number="triggers.angst"
                                                       @input="clampValue('angst')"
                                                       class="w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-purple-500">
                                            </div>
                                            <div>
                                                <label class="block text-xs font-medium text-gray-700 mb-1">Wut</label>
                                                <input type="number" min="0" max="5" x-model.number="triggers.wut"
                                                       @input="clampValue('wut')"
                                                       class="w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-purple-500">
                                            </div>
                                            <div>
                                                <label class="block text-xs font-medium text-gray-700 mb-1">Emp√∂rung</label>
                                                <input type="number" min="0" max="5" x-model.number="triggers.empoerung"
                                                       @input="clampValue('empoerung')"
                                                       class="w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-purple-500">
                                            </div>
                                            <div>
                                                <label class="block text-xs font-medium text-gray-700 mb-1">Ekel</label>
                                                <input type="number" min="0" max="5" x-model.number="triggers.ekel"
                                                       @input="clampValue('ekel')"
                                                       class="w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-purple-500">
                                            </div>
                                            <div>
                                                <label class="block text-xs font-medium text-gray-700 mb-1">Identit√§tsbezug</label>
                                                <input type="number" min="0" max="5" x-model.number="triggers.identitaet"
                                                       @input="clampValue('identitaet')"
                                                       class="w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-purple-500">
                                            </div>
                                            <div>
                                                <label class="block text-xs font-medium text-gray-700 mb-1">Hoffnung/Stolz</label>
                                                <input type="number" min="0" max="5" x-model.number="triggers.hoffnung"
                                                       @input="clampValue('hoffnung')"
                                                       class="w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-purple-500">
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Frames Section -->
                                    <div class="mb-4">
                                        <h5 class="text-sm font-bold text-gray-800 mb-3 flex items-center">
                                            <span class="text-lg mr-2">üß©</span> Thematische Frames (Bin√§r 0-1)
                                        </h5>
                                        <div class="grid grid-cols-2 md:grid-cols-5 gap-3">
                                            <label class="flex items-center space-x-2 cursor-pointer">
                                                <input type="checkbox" x-model="frames.opfer_taeter" true-value="1" false-value="0"
                                                       class="w-5 h-5 text-purple-600 rounded focus:ring-2 focus:ring-purple-500">
                                                <span class="text-sm text-gray-700">Opfer-T√§ter</span>
                                            </label>
                                            <label class="flex items-center space-x-2 cursor-pointer">
                                                <input type="checkbox" x-model="frames.bedrohung" true-value="1" false-value="0"
                                                       class="w-5 h-5 text-purple-600 rounded focus:ring-2 focus:ring-purple-500">
                                                <span class="text-sm text-gray-700">Bedrohung</span>
                                            </label>
                                            <label class="flex items-center space-x-2 cursor-pointer">
                                                <input type="checkbox" x-model="frames.verschwoerung" true-value="1" false-value="0"
                                                       class="w-5 h-5 text-purple-600 rounded focus:ring-2 focus:ring-purple-500">
                                                <span class="text-sm text-gray-700">Verschw√∂rung</span>
                                            </label>
                                            <label class="flex items-center space-x-2 cursor-pointer">
                                                <input type="checkbox" x-model="frames.moral" true-value="1" false-value="0"
                                                       class="w-5 h-5 text-purple-600 rounded focus:ring-2 focus:ring-purple-500">
                                                <span class="text-sm text-gray-700">Moral</span>
                                            </label>
                                            <label class="flex items-center space-x-2 cursor-pointer">
                                                <input type="checkbox" x-model="frames.historisch" true-value="1" false-value="0"
                                                       class="w-5 h-5 text-purple-600 rounded focus:ring-2 focus:ring-purple-500">
                                                <span class="text-sm text-gray-700">Historisch</span>
                                            </label>
                                        </div>
                                    </div>

                                    <!-- Save Button -->
                                    <div class="mt-4 flex justify-end">
                                        <button @click="saveTriggerFrame(post.id, {
                                            trigger_angst: triggers.angst,
                                            trigger_wut: triggers.wut,
                                            trigger_empoerung: triggers.empoerung,
                                            trigger_ekel: triggers.ekel,
                                            trigger_identitaet: triggers.identitaet,
                                            trigger_hoffnung: triggers.hoffnung,
                                            frame_opfer_taeter: frames.opfer_taeter ? 1 : 0,
                                            frame_bedrohung: frames.bedrohung ? 1 : 0,
                                            frame_verschwoerung: frames.verschwoerung ? 1 : 0,
                                            frame_moral: frames.moral ? 1 : 0,
                                            frame_historisch: frames.historisch ? 1 : 0
                                        })"
                                                class="px-6 py-2 bg-gradient-to-r from-purple-500 to-indigo-500 text-white rounded-lg hover:from-purple-600 hover:to-indigo-600 transition-colors font-medium text-sm">
                                            üíæ Speichern
                                        </button>
                                    </div>

                                </div>
                            </template>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Advanced Statistics Tab -->
            <div x-show="currentTab === 'advanced'" class="fade-in">

                <div class="bg-gradient-to-r from-indigo-50 to-purple-50 border-l-4 border-indigo-500 p-6 mb-6 rounded-lg">
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">üìà Erweiterte Statistiken</h2>
                    <p class="text-sm text-gray-700">
                        Statistische Analysen zu Zusammenh√§ngen zwischen Trigger, Frames und TER
                    </p>
                </div>

                <div x-show="!advancedStats" class="text-center py-12">
                    <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-primary"></div>
                    <p class="mt-4 text-gray-600">Lade erweiterte Statistiken...</p>
                </div>

                <div x-show="advancedStats && advancedStats.error" class="bg-yellow-50 border-l-4 border-yellow-400 p-4">
                    <p class="text-yellow-700" x-text="advancedStats?.error || ''"></p>
                </div>

                <div x-show="advancedStats && !advancedStats.error" class="space-y-6">

                    <!-- Deskriptive √úbersicht -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-bold text-gray-900 mb-4">üìä Daten√ºbersicht</h3>
                        <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
                            <div class="text-center">
                                <div class="text-3xl font-bold text-primary" x-text="advancedStats?.descriptive?.post_count || 0"></div>
                                <div class="text-sm text-gray-600">Posts analysiert</div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-primary" x-text="advancedStats?.descriptive?.ter_mean + '%' || '0%'"></div>
                                <div class="text-sm text-gray-600">√ò TER</div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-primary" x-text="advancedStats?.descriptive?.ter_std + '%' || '0%'"></div>
                                <div class="text-sm text-gray-600">Std.-Abw.</div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-green-600" x-text="advancedStats?.descriptive?.ter_min + '%' || '0%'"></div>
                                <div class="text-sm text-gray-600">Min TER</div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-red-600" x-text="advancedStats?.descriptive?.ter_max + '%' || '0%'"></div>
                                <div class="text-sm text-gray-600">Max TER</div>
                            </div>
                        </div>
                    </div>

                    <!-- Korrelationsanalyse -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-bold text-gray-900 mb-2">üîó Korrelationsanalyse (Pearson)</h3>
                        <p class="text-sm text-gray-600 mb-4">Zusammenhang zwischen Trigger/Frames und TER</p>

                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Variable</th>
                                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase">Korrelation (r)</th>
                                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase">p-Wert</th>
                                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase">Signifikant?</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <template x-for="[name, data] in Object.entries(advancedStats?.correlations || {})" :key="name">
                                        <tr>
                                            <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900" x-text="name"></td>
                                            <td class="px-4 py-3 text-center">
                                                <span :class="Math.abs(data.correlation) > 0.5 ? 'text-red-600 font-bold' : Math.abs(data.correlation) > 0.3 ? 'text-orange-600 font-semibold' : 'text-gray-600'"
                                                      x-text="data.correlation"></span>
                                            </td>
                                            <td class="px-4 py-3 text-center text-sm text-gray-600" x-text="data.p_value"></td>
                                            <td class="px-4 py-3 text-center">
                                                <span x-show="data.significant" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                                    ‚úì Ja (p < 0.05)
                                                </span>
                                                <span x-show="!data.significant" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                                                    ‚úó Nein
                                                </span>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>

                        <div class="mt-4 text-xs text-gray-500 bg-blue-50 p-3 rounded">
                            <strong>Interpretation:</strong> r > 0.5 = starker Zusammenhang | 0.3 < r < 0.5 = mittlerer Zusammenhang | r < 0.3 = schwacher Zusammenhang
                        </div>
                    </div>

                    <!-- Regressionsanalyse -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-bold text-gray-900 mb-2">üìê Regressionsanalyse</h3>
                        <p class="text-sm text-gray-600 mb-4">Einflussst√§rke der Trigger & Frames auf TER (kontrolliert f√ºr alle anderen Variablen)</p>

                        <div class="mb-4">
                            <div class="flex items-center space-x-4">
                                <div>
                                    <span class="text-sm text-gray-600">R¬≤ =</span>
                                    <span class="text-lg font-bold text-primary" x-text="advancedStats?.regression?.r_squared"></span>
                                </div>
                                <div class="text-xs text-gray-500">
                                    (Modellg√ºte: Anteil erkl√§rter Varianz)
                                </div>
                            </div>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Feature</th>
                                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase">Koeffizient (Œ≤)</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Interpretation</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <template x-for="coef in advancedStats?.regression?.coefficients || []" :key="coef.feature">
                                        <tr>
                                            <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900" x-text="coef.feature"></td>
                                            <td class="px-4 py-3 text-center">
                                                <span :class="coef.coefficient > 0 ? 'text-green-600 font-bold' : 'text-red-600 font-bold'"
                                                      x-text="coef.coefficient > 0 ? '+' + coef.coefficient : coef.coefficient"></span>
                                            </td>
                                            <td class="px-4 py-3 text-sm text-gray-600">
                                                <span x-show="Math.abs(coef.coefficient) > 1">Starker Effekt</span>
                                                <span x-show="Math.abs(coef.coefficient) <= 1 && Math.abs(coef.coefficient) > 0.5">Mittlerer Effekt</span>
                                                <span x-show="Math.abs(coef.coefficient) <= 0.5">Schwacher Effekt</span>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>

                        <div class="mt-4 text-xs text-gray-500 bg-blue-50 p-3 rounded">
                            <strong>Interpretation:</strong> Positiver Œ≤-Wert = h√∂herer Trigger ‚Üí h√∂herer TER | Negativer Œ≤-Wert = h√∂herer Trigger ‚Üí niedrigerer TER
                        </div>
                    </div>

                    <!-- Gruppenvergleiche (t-Tests) -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-bold text-gray-900 mb-2">‚öñÔ∏è Gruppenvergleiche (t-Tests)</h3>
                        <p class="text-sm text-gray-600 mb-4">Unterschiede im TER zwischen Posts mit vs. ohne Frame</p>

                        <div class="space-y-4">
                            <template x-for="comparison in advancedStats?.group_comparisons || []" :key="comparison.frame">
                                <div class="border border-gray-200 rounded-lg p-4">
                                    <h4 class="font-semibold text-gray-900 mb-3" x-text="comparison.frame"></h4>

                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-3">
                                        <div class="bg-blue-50 p-3 rounded">
                                            <div class="text-xs text-gray-600 mb-1">Mit Frame</div>
                                            <div class="text-lg font-bold text-blue-600" x-text="comparison.with_frame.mean_ter + '%'"></div>
                                            <div class="text-xs text-gray-500" x-text="'n = ' + comparison.with_frame.count"></div>
                                        </div>
                                        <div class="bg-gray-50 p-3 rounded">
                                            <div class="text-xs text-gray-600 mb-1">Ohne Frame</div>
                                            <div class="text-lg font-bold text-gray-600" x-text="comparison.without_frame.mean_ter + '%'"></div>
                                            <div class="text-xs text-gray-500" x-text="'n = ' + comparison.without_frame.count"></div>
                                        </div>
                                        <div class="bg-green-50 p-3 rounded">
                                            <div class="text-xs text-gray-600 mb-1">Unterschied</div>
                                            <div class="text-lg font-bold"
                                                 :class="comparison.effect_size > 0 ? 'text-green-600' : 'text-red-600'"
                                                 x-text="(comparison.effect_size > 0 ? '+' : '') + comparison.effect_size + '%'"></div>
                                            <div class="text-xs" :class="comparison.significant ? 'text-green-600 font-semibold' : 'text-gray-500'">
                                                <span x-text="comparison.significant ? '‚úì Signifikant' : '‚úó Nicht signifikant'"></span>
                                                <span x-text="' (p = ' + comparison.p_value + ')'"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>

                        <div class="mt-4 text-xs text-gray-500 bg-blue-50 p-3 rounded">
                            <strong>Interpretation:</strong> p < 0.05 = signifikanter Unterschied (mit 95% Sicherheit nicht zuf√§llig)
                        </div>
                    </div>

                    <!-- Clusteranalyse -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-bold text-gray-900 mb-2">üîç Clusteranalyse (K-Means)</h3>
                        <p class="text-sm text-gray-600 mb-4">Nat√ºrliche Gruppierung von Posts anhand ihrer Trigger-Profile</p>

                        <!-- Nicht genug Daten -->
                        <div x-show="!advancedStats?.clusters || advancedStats?.clusters === null" class="bg-blue-50 border-l-4 border-blue-400 p-4">
                            <div class="flex items-start">
                                <svg class="h-5 w-5 text-blue-400 mt-0.5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                                </svg>
                                <div>
                                    <p class="text-blue-700 font-semibold">Mindestens 10 Posts mit Trigger-Daten erforderlich</p>
                                    <p class="text-blue-600 text-sm mt-1">
                                        Aktuell: <span x-text="advancedStats?.descriptive?.post_count || 0"></span> Posts analysiert.
                                        F√ºge mindestens <span x-text="Math.max(0, 10 - (advancedStats?.descriptive?.post_count || 0))"></span> weitere Posts mit Trigger-Werten hinzu, um typische Trigger-Profile zu identifizieren.
                                    </p>
                                    <p class="text-blue-600 text-sm mt-2">
                                        <strong>Was die Clusteranalyse zeigen wird:</strong><br>
                                        ‚Ä¢ Gruppierung von Posts mit √§hnlichen emotionalen Triggern<br>
                                        ‚Ä¢ Identifikation typischer Trigger-Profile (z.B. "Wut+Emp√∂rung" vs. "Angst+Bedrohung")<br>
                                        ‚Ä¢ Durchschnittlicher TER pro Cluster zur Bewertung der Engagement-Effektivit√§t
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Error Message -->
                        <div x-show="advancedStats?.clusters?.error" class="bg-yellow-50 border-l-4 border-yellow-400 p-4">
                            <p class="text-yellow-700" x-text="advancedStats?.clusters?.error || ''"></p>
                        </div>

                        <!-- Cluster Results -->
                        <div x-show="advancedStats?.clusters && advancedStats.clusters.profiles">

                        <div class="space-y-4">
                            <template x-for="(cluster, index) in advancedStats?.clusters?.profiles || []" :key="cluster.cluster_id">
                                <div class="border-2 rounded-lg p-5"
                                     :class="index === 0 ? 'border-green-500 bg-green-50' : index === 1 ? 'border-yellow-500 bg-yellow-50' : 'border-red-500 bg-red-50'">

                                    <div class="flex justify-between items-start mb-4">
                                        <div>
                                            <h4 class="text-lg font-bold text-gray-900">
                                                Cluster <span x-text="index + 1"></span>:
                                                <span x-text="cluster.dominant_trigger + '-dominiert'"></span>
                                            </h4>
                                            <div class="text-sm text-gray-600 mt-1">
                                                <span x-text="cluster.size"></span> Posts |
                                                √ò TER: <span class="font-bold" x-text="cluster.avg_ter + '%'"></span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="grid grid-cols-5 gap-3">
                                        <template x-for="[trigger, value] in Object.entries(cluster.trigger_profile)" :key="trigger">
                                            <div class="text-center">
                                                <div class="text-2xl font-bold"
                                                     :class="trigger === cluster.dominant_trigger ? 'text-primary' : 'text-gray-600'"
                                                     x-text="value"></div>
                                                <div class="text-xs text-gray-600" x-text="trigger"></div>
                                                <div class="w-full bg-gray-200 rounded-full h-2 mt-1">
                                                    <div class="bg-primary h-2 rounded-full"
                                                         :style="'width: ' + (value / 5 * 100) + '%'"></div>
                                                </div>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </template>
                        </div>

                        <div class="mt-4 text-xs text-gray-500 bg-blue-50 p-3 rounded">
                            <strong>Interpretation:</strong> Cluster gruppieren Posts mit √§hnlichen Trigger-Profilen. Der dominante Trigger kennzeichnet das charakteristische Merkmal des Clusters.
                        </div>

                        </div> <!-- End Cluster Results -->
                    </div> <!-- End Clusteranalyse -->

                </div>
            </div>

            <!-- ===== ARCHIVE TAB ===== -->
            <!-- ===== FAVORITES TAB ===== -->
            <div x-show="currentTab === 'favorites'" class="fade-in">

                <div class="bg-gradient-to-r from-yellow-50 to-amber-50 border-l-4 border-yellow-500 p-6 mb-6 rounded-lg">
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">‚≠ê Favoriten - Session-√ºbergreifende Sammlung</h2>
                    <p class="text-sm text-gray-700">
                        Hier findest du deine favorisierten Posts aus allen Sessions. Diese Sammlung bleibt √ºber alle Analysesitzungen hinweg erhalten.
                    </p>
                </div>

                <!-- Favorites Stats -->
                <div class="bg-white rounded-lg shadow-md p-4 mb-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="text-3xl font-bold text-yellow-600" x-text="favoritePosts.length"></div>
                            <div class="text-sm text-gray-600">Favorisierte Posts</div>
                        </div>
                        <div class="flex space-x-3">
                            <button @click="exportFavoritesCSV()"
                                    x-show="favoritePosts.length > 0"
                                    class="bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600 transition-colors flex items-center space-x-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                </svg>
                                <span>üì• CSV Export</span>
                            </button>
                            <button @click="loadFavoritePosts()" class="bg-primary text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                                üîÑ Aktualisieren
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Loading State -->
                <div x-show="loadingFavorites" class="text-center py-12">
                    <svg class="animate-spin h-12 w-12 mx-auto text-primary" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <p class="mt-4 text-gray-500">Lade Favoriten...</p>
                </div>

                <!-- Empty State -->
                <div x-show="!loadingFavorites && favoritePosts.length === 0" class="text-center py-12 bg-white rounded-lg shadow-md">
                    <svg class="h-16 w-16 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
                    </svg>
                    <p class="text-gray-500 font-medium">Noch keine Favoriten</p>
                    <p class="text-sm text-gray-400 mt-2">Markiere Posts als Favoriten, um sie hier zu sammeln</p>
                </div>

                <!-- Favorite Posts List -->
                <div x-show="!loadingFavorites && favoritePosts.length > 0" class="space-y-4">
                    <template x-for="(post, index) in favoritePosts" :key="post.id">
                        <div class="bg-white rounded-lg shadow-md p-6 border-2 border-yellow-200">

                            <!-- Header -->
                            <div class="flex items-start justify-between mb-4">
                                <div class="flex-1">
                                    <div class="flex items-center space-x-2 mb-2">
                                        <span class="text-sm font-semibold text-gray-500" x-text="'#' + (index + 1)"></span>
                                        <span class="bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded-full font-medium">‚≠ê Favorit</span>
                                        <span x-show="post.is_reviewed" class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full font-medium">‚úì Reviewed</span>
                                        <span x-show="post.is_archived" class="bg-red-100 text-red-800 text-xs px-2 py-1 rounded-full font-medium">üì¶ Archiviert</span>
                                    </div>
                                    <h3 class="text-lg font-bold text-gray-900 mb-1" x-text="post.factcheck_title || 'Kein Titel'"></h3>
                                    <div class="flex items-center space-x-2 text-sm text-gray-500">
                                        <span>üìÖ</span>
                                        <span x-text="post.twitter_date"></span>
                                        <span>|</span>
                                        <span x-text="'@' + post.twitter_handle"></span>
                                        <span x-show="post.twitter_followers > 0" x-text="'(' + post.twitter_followers.toLocaleString() + ' Followers)'"></span>
                                    </div>
                                </div>

                                <!-- Actions -->
                                <div class="flex space-x-2">
                                    <button @click="unfavoritePost(post.id)"
                                            class="bg-yellow-500 text-white px-4 py-2 rounded-lg hover:bg-yellow-600 transition-colors text-sm font-medium">
                                        ‚≠ê Entfernen
                                    </button>
                                    <a :href="post.twitter_url" target="_blank"
                                       class="bg-twitter text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors text-sm font-medium">
                                        üîó Tweet √∂ffnen
                                    </a>
                                </div>
                            </div>

                            <!-- Content -->
                            <div class="bg-gray-50 rounded-lg p-4 mb-4">
                                <p class="text-sm text-gray-700 whitespace-pre-wrap" x-text="post.twitter_content"></p>
                            </div>

                            <!-- Post Details -->
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 text-sm">
                                <div>
                                    <span class="text-gray-500">TER (Auto):</span>
                                    <span class="font-semibold ml-1" x-text="post.ter_automatic ? post.ter_automatic.toFixed(2) : 'N/A'"></span>
                                </div>
                                <div>
                                    <span class="text-gray-500">TER (Manual):</span>
                                    <span class="font-semibold ml-1" x-text="post.ter_manual !== null ? post.ter_manual.toFixed(2) : 'N/A'"></span>
                                </div>
                                <div>
                                    <span class="text-gray-500">Views:</span>
                                    <span class="font-semibold ml-1" x-text="(post.views_manual !== null ? post.views_manual : post.views).toLocaleString()"></span>
                                </div>
                                <div>
                                    <span class="text-gray-500">Likes:</span>
                                    <span class="font-semibold ml-1" x-text="(post.likes_manual !== null ? post.likes_manual : post.likes).toLocaleString()"></span>
                                </div>
                            </div>

                            <!-- Notes -->
                            <div x-show="post.notes" class="mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                                <div class="text-xs font-medium text-yellow-800 mb-1">Notizen:</div>
                                <div class="text-sm text-gray-700" x-text="post.notes"></div>
                            </div>

                        </div>
                    </template>
                </div>

            </div>

            <!-- ===== ARCHIVE TAB ===== -->
            <div x-show="currentTab === 'archive'" class="fade-in">

                <div class="bg-gradient-to-r from-red-50 to-orange-50 border-l-4 border-red-500 p-6 mb-6 rounded-lg">
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">üì¶ Archiv - Nicht mehr verf√ºgbare Posts</h2>
                    <p class="text-sm text-gray-700">
                        Hier findest du alle archivierten Posts, die nicht mehr verf√ºgbar sind. Diese Posts werden von allen Statistiken und Auswertungen ausgeschlossen.
                    </p>
                </div>

                <!-- Archive Stats -->
                <div class="bg-white rounded-lg shadow-md p-4 mb-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="text-3xl font-bold text-red-600" x-text="archivedPosts.length"></div>
                            <div class="text-sm text-gray-600">Archivierte Posts</div>
                        </div>
                        <button @click="loadArchivedPosts()" class="bg-primary text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                            üîÑ Aktualisieren
                        </button>
                    </div>
                </div>

                <!-- Loading State -->
                <div x-show="loadingArchived" class="text-center py-12">
                    <svg class="animate-spin h-12 w-12 mx-auto text-primary" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <p class="mt-4 text-gray-500">Lade archivierte Posts...</p>
                </div>

                <!-- Empty State -->
                <div x-show="!loadingArchived && archivedPosts.length === 0" class="text-center py-12 bg-white rounded-lg shadow-md">
                    <svg class="h-16 w-16 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"/>
                    </svg>
                    <p class="text-gray-500 font-medium">Keine archivierten Posts</p>
                    <p class="text-sm text-gray-400 mt-2">Archivierte Posts erscheinen hier</p>
                </div>

                <!-- Archived Posts List -->
                <div x-show="!loadingArchived && archivedPosts.length > 0" class="space-y-4">
                    <template x-for="(post, index) in archivedPosts" :key="post.id">
                        <div class="bg-white rounded-lg shadow-md p-6 border-2 border-red-200">

                            <!-- Header -->
                            <div class="flex items-start justify-between mb-4">
                                <div class="flex-1">
                                    <div class="flex items-center space-x-2 mb-2">
                                        <span class="text-sm font-semibold text-gray-500" x-text="'#' + (index + 1)"></span>
                                        <span class="bg-red-100 text-red-800 text-xs px-2 py-1 rounded-full font-medium">üì¶ Archiviert</span>
                                        <span x-show="post.is_reviewed" class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full font-medium">‚úì Reviewed</span>
                                    </div>
                                    <h3 class="text-lg font-bold text-gray-900 mb-1" x-text="post.factcheck_title || 'Kein Titel'"></h3>
                                    <div class="flex items-center space-x-2 text-sm text-gray-500">
                                        <span>üìÖ</span>
                                        <span x-text="post.twitter_date"></span>
                                        <span>|</span>
                                        <span x-text="'@' + post.twitter_handle"></span>
                                        <span x-show="post.twitter_followers > 0" x-text="'(' + post.twitter_followers.toLocaleString() + ' Followers)'"></span>
                                    </div>
                                </div>

                                <!-- Actions -->
                                <div class="flex space-x-2">
                                    <button @click="unarchivePost(post.id)"
                                            class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors text-sm font-medium">
                                        ‚Ü©Ô∏è Wiederherstellen
                                    </button>
                                    <button @click="deletePost(post.id)"
                                            class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors text-sm font-medium">
                                        üóëÔ∏è L√∂schen
                                    </button>
                                </div>
                            </div>

                            <!-- Content -->
                            <div class="bg-gray-50 rounded-lg p-4 mb-4">
                                <p class="text-sm text-gray-700 whitespace-pre-wrap" x-text="post.twitter_content"></p>
                            </div>

                            <!-- Post Details -->
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 text-sm">
                                <div>
                                    <span class="text-gray-500">TER (Auto):</span>
                                    <span class="font-semibold ml-1" x-text="post.ter_automatic ? post.ter_automatic.toFixed(2) + '%' : 'N/A'"></span>
                                </div>
                                <div>
                                    <span class="text-gray-500">TER (Manual):</span>
                                    <span class="font-semibold ml-1" x-text="post.ter_manual !== null ? post.ter_manual.toFixed(2) + '%' : 'N/A'"></span>
                                </div>
                                <div>
                                    <span class="text-gray-500">Views:</span>
                                    <span class="font-semibold ml-1" x-text="post.views.toLocaleString()"></span>
                                </div>
                                <div>
                                    <span class="text-gray-500">Likes:</span>
                                    <span class="font-semibold ml-1" x-text="post.likes.toLocaleString()"></span>
                                </div>
                            </div>

                            <!-- Notes -->
                            <div x-show="post.notes" class="mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                                <div class="text-xs font-medium text-yellow-800 mb-1">Notizen:</div>
                                <div class="text-sm text-gray-700" x-text="post.notes"></div>
                            </div>

                        </div>
                    </template>
                </div>

            </div>

        </div>

    </main>

    <!-- Alpine.js Data -->
    <script>
        function dashboardApp() {
            return {
                // State
                currentTab: localStorage.getItem('currentTab') || 'upload',
                loading: false,
                uploading: false,
                dragOver: false,
                selectedFile: null,
                uploadResult: null,
                triggersFramesUploadStatus: {
                    message: '',
                    success: false,
                    matched: null,
                    not_matched: null
                },

                // Notifications
                notifications: [],

                // Confirmation Dialog
                confirmDialog: {
                    show: false,
                    message: '',
                    onConfirm: null
                },

                // Session Management
                sessions: [],
                activeSession: null,
                sessionDialog: {
                    show: false,
                    mode: 'create', // 'create' or 'manage'
                    newSession: {
                        name: '',
                        description: ''
                    }
                },

                // Data
                posts: [],
                allPosts: [],  // All posts for CSV table view
                archivedPosts: [],  // Archived posts
                loadingArchived: false,
                favoritePosts: [],  // Favorite posts
                loadingFavorites: false,
                stats: {
                    total_posts: 0,
                    reviewed_posts: 0,
                    unreviewed_posts: 0
                },
                statistics: {},

                // Filter
                filter: {
                    reviewed: 'all',
                    sort: 'created_at',
                    order: 'desc'
                },

                // Manual TER Calculator
                manualCalc: {
                    postId: null,
                    values: {
                        views: 0,
                        likes: 0,
                        bookmarks: 0,
                        replies: 0,
                        retweets: 0,
                        quotes: 0
                    },
                    result: {
                        ter: 0,
                        ter_sqrt: 0,
                        ter_linear: 0,
                        weighted_engagement: 0,
                        total_interactions: 0,
                        engagement_level: '',
                        engagement_level_code: ''
                    }
                },

                // Reviewed Posts
                reviewedSort: 'ter_manual_desc',

                // Handle Filter (Review Mode)
                availableHandles: [],
                selectedHandles: [],
                showHandleDropdown: false,

                // Factchecker Filter (Review Mode)
                availableFactcheckers: [],
                selectedFactcheckers: [],
                showFactcheckerDropdown: false,

                // Pagination
                pagination: {
                    currentPage: 1,
                    itemsPerPage: 10
                },

                // Timeline Charts
                timelineView: 'monthly',
                timelineData: {
                    monthly: [],
                    yearly: []
                },

                // Advanced Statistics
                advancedStats: null,
                charts: {
                    postCount: null,
                    terTimeline: null
                },

                // Computed Properties
                get reviewedPosts() {
                    // Reviewed Posts Tab sollte ALLE reviewed Posts zeigen, ohne Handle/Factchecker Filter
                    return this.posts.filter(p => p.is_reviewed);
                },

                get paginatedPosts() {
                    const start = (this.pagination.currentPage - 1) * this.pagination.itemsPerPage;
                    const end = start + this.pagination.itemsPerPage;
                    return this.posts.slice(start, end);
                },

                get totalPages() {
                    return Math.ceil(this.posts.length / this.pagination.itemsPerPage);
                },

                // Initialization
                async init() {
                    await this.loadSessions();
                    await this.loadActiveSession();
                    await this.loadStats();
                    await this.loadPosts();
                    await this.loadAllPosts();
                    await this.loadStatistics();
                    await this.loadTimelineData();
                    await this.loadAvailableHandles();
                    await this.loadAvailableFactcheckers();
                },

                // Keyboard Navigation for Engagement Metrics (4 directions)
                handleMetricNavigation(event, direction) {
                    const target = event.target;
                    if (!target.classList.contains('metric-input')) return;

                    const currentIndex = parseInt(target.dataset.metricIndex);
                    const inputs = target.closest('.grid').querySelectorAll('.metric-input');
                    const totalInputs = inputs.length;

                    // Grid layout: 3 columns (desktop) or 2 columns (mobile)
                    // Indices: 0=Views, 1=Likes, 2=Retweets, 3=Replies, 4=Bookmarks, 5=Quotes
                    const cols = window.innerWidth >= 768 ? 3 : 2; // md breakpoint
                    const rows = Math.ceil(totalInputs / cols);

                    let nextIndex;

                    switch(direction) {
                        case 'right':
                            nextIndex = currentIndex + 1;
                            if (nextIndex >= totalInputs) nextIndex = 0; // Wrap to start
                            break;

                        case 'left':
                            nextIndex = currentIndex - 1;
                            if (nextIndex < 0) nextIndex = totalInputs - 1; // Wrap to end
                            break;

                        case 'down':
                            nextIndex = currentIndex + cols;
                            if (nextIndex >= totalInputs) {
                                // Wrap to first row, same column
                                nextIndex = currentIndex % cols;
                            }
                            break;

                        case 'up':
                            nextIndex = currentIndex - cols;
                            if (nextIndex < 0) {
                                // Wrap to last row, same column
                                const col = currentIndex % cols;
                                const lastRowStart = (rows - 1) * cols;
                                nextIndex = lastRowStart + col;
                                if (nextIndex >= totalInputs) {
                                    nextIndex = lastRowStart + col - cols; // Previous row if needed
                                }
                            }
                            break;

                        default:
                            return;
                    }

                    const nextInput = inputs[nextIndex];
                    if (nextInput) {
                        event.preventDefault();
                        nextInput.focus();
                        nextInput.select(); // Select all text for easy overwriting
                    }
                },

                // Notification System
                showNotification(message, type = 'success') {
                    const id = Date.now();
                    this.notifications.push({
                        id: id,
                        message: message,
                        type: type  // 'success', 'error', 'info', 'warning'
                    });

                    // Auto-remove nach 5 Sekunden
                    setTimeout(() => {
                        this.removeNotification(id);
                    }, 5000);
                },

                removeNotification(id) {
                    const index = this.notifications.findIndex(n => n.id === id);
                    if (index !== -1) {
                        this.notifications.splice(index, 1);
                    }
                },

                showConfirm(message, onConfirm) {
                    this.confirmDialog.message = message;
                    this.confirmDialog.onConfirm = onConfirm;
                    this.confirmDialog.show = true;
                },

                confirmAction() {
                    if (this.confirmDialog.onConfirm) {
                        this.confirmDialog.onConfirm();
                    }
                    this.confirmDialog.show = false;
                    this.confirmDialog.onConfirm = null;
                },

                cancelAction() {
                    this.confirmDialog.show = false;
                    this.confirmDialog.onConfirm = null;
                },

                // API Calls
                async loadStats() {
                    try {
                        const response = await fetch('/api/posts');
                        const data = await response.json();

                        this.stats.total_posts = data.total || 0;
                        this.stats.reviewed_posts = data.posts.filter(p => p.is_reviewed).length;
                        this.stats.unreviewed_posts = data.posts.filter(p => !p.is_reviewed).length;
                    } catch (error) {
                        console.error('Error loading stats:', error);
                    }
                },

                async loadPosts(keepPagination = false) {
                    this.loading = true;

                    try {
                        let url = '/api/posts?';
                        if (this.filter.reviewed !== 'all') {
                            url += `reviewed=${this.filter.reviewed}&`;
                        }
                        url += `sort=${this.filter.sort}&order=${this.filter.order}`;

                        const response = await fetch(url);
                        const data = await response.json();

                        this.posts = (data.posts || []).map(post => ({
                            ...post,
                            showPreview: false  // Initialize preview state
                        }));

                        // Update stats - always load all posts to get accurate counts
                        await this.loadStats();

                        // Reset pagination to first page (unless keepPagination is true)
                        if (!keepPagination) {
                            this.resetPagination();
                        }
                    } catch (error) {
                        console.error('Error loading posts:', error);
                        this.showNotification('Fehler beim Laden der Posts', 'error');
                    } finally {
                        this.loading = false;
                    }
                },

                async loadAllPosts() {
                    try {
                        const response = await fetch('/api/posts');
                        const data = await response.json();
                        this.allPosts = (data.posts || []).map(post => ({
                            ...post,
                            showPreview: false  // Initialize preview state
                        }));
                    } catch (error) {
                        console.error('Error loading all posts:', error);
                    }
                },

                async loadStatistics() {
                    try {
                        const response = await fetch('/api/stats');
                        const data = await response.json();
                        this.statistics = data;
                    } catch (error) {
                        console.error('Error loading statistics:', error);
                    }
                },

                async loadTimelineData() {
                    try {
                        const response = await fetch('/api/stats/timeline');
                        const data = await response.json();
                        this.timelineData = data;

                        // Charts werden NUR gerendert, wenn der Statistik-Tab aktiv ist
                        // (siehe Tab-Wechsel Button mit $nextTick)
                    } catch (error) {
                        console.error('Error loading timeline data:', error);
                    }
                },

                async loadAdvancedStats() {
                    try {
                        this.advancedStats = null;  // Reset
                        const response = await fetch('/api/stats/advanced');
                        const data = await response.json();
                        this.advancedStats = data;
                    } catch (error) {
                        console.error('Error loading advanced stats:', error);
                        this.showNotification('Fehler beim Laden der erweiterten Statistiken', 'error');
                    }
                },

                async loadAvailableHandles() {
                    try {
                        const response = await fetch('/api/handles');
                        const data = await response.json();
                        this.availableHandles = data.handles || [];

                        // Load from localStorage if available
                        const savedHandles = localStorage.getItem('selectedHandles');
                        if (savedHandles) {
                            try {
                                const parsed = JSON.parse(savedHandles);
                                // Only use saved handles that still exist in availableHandles
                                this.selectedHandles = parsed.filter(h => this.availableHandles.includes(h));
                            } catch (e) {
                                // If parsing fails, use all handles
                                this.selectedHandles = [...this.availableHandles];
                            }
                        } else {
                            // Initialize selectedHandles with all handles (show all by default)
                            this.selectedHandles = [...this.availableHandles];
                        }

                        // Save to localStorage
                        this.saveHandleFilters();
                    } catch (error) {
                        console.error('Error loading available handles:', error);
                    }
                },

                toggleHandle(handle) {
                    const index = this.selectedHandles.indexOf(handle);
                    if (index === -1) {
                        // Add handle to filter
                        this.selectedHandles.push(handle);
                    } else {
                        // Remove handle from filter
                        this.selectedHandles.splice(index, 1);
                    }
                    this.saveHandleFilters();
                },

                selectAllHandles() {
                    this.selectedHandles = [...this.availableHandles];
                    this.saveHandleFilters();
                },

                deselectAllHandles() {
                    this.selectedHandles = [];
                    this.saveHandleFilters();
                },

                saveHandleFilters() {
                    localStorage.setItem('selectedHandles', JSON.stringify(this.selectedHandles));
                },

                async loadAvailableFactcheckers() {
                    try {
                        const response = await fetch('/api/factcheckers');
                        const data = await response.json();
                        this.availableFactcheckers = data.factcheckers || [];

                        // Load from localStorage if available
                        const savedFactcheckers = localStorage.getItem('selectedFactcheckers');
                        if (savedFactcheckers) {
                            try {
                                const parsed = JSON.parse(savedFactcheckers);
                                const availableDomains = this.availableFactcheckers.map(f => f.domain);
                                // Only use saved factcheckers that still exist in availableFactcheckers
                                this.selectedFactcheckers = parsed.filter(d => availableDomains.includes(d));
                            } catch (e) {
                                // If parsing fails, use all factcheckers
                                this.selectedFactcheckers = this.availableFactcheckers.map(f => f.domain);
                            }
                        } else {
                            // Initialize selectedFactcheckers with all domains (show all by default)
                            this.selectedFactcheckers = this.availableFactcheckers.map(f => f.domain);
                        }

                        // Save to localStorage
                        this.saveFactcheckerFilters();
                    } catch (error) {
                        console.error('Error loading available factcheckers:', error);
                    }
                },

                toggleFactchecker(domain) {
                    const index = this.selectedFactcheckers.indexOf(domain);
                    if (index === -1) {
                        // Add factchecker to filter
                        this.selectedFactcheckers.push(domain);
                    } else {
                        // Remove factchecker from filter
                        this.selectedFactcheckers.splice(index, 1);
                    }
                    this.saveFactcheckerFilters();
                },

                selectAllFactcheckers() {
                    this.selectedFactcheckers = this.availableFactcheckers.map(f => f.domain);
                    this.saveFactcheckerFilters();
                },

                deselectAllFactcheckers() {
                    this.selectedFactcheckers = [];
                    this.saveFactcheckerFilters();
                },

                saveFactcheckerFilters() {
                    localStorage.setItem('selectedFactcheckers', JSON.stringify(this.selectedFactcheckers));
                },

                renderTimelineCharts() {
                    const currentData = this.timelineView === 'monthly' ? this.timelineData.monthly : this.timelineData.yearly;

                    if (!currentData || currentData.length === 0) {
                        console.log('No timeline data available');
                        return;
                    }

                    const labels = currentData.map(d => d.label);
                    const postCounts = currentData.map(d => d.post_count);
                    const avgTers = currentData.map(d => d.avg_ter);

                    // Destroy existing charts completely
                    if (this.charts.postCount) {
                        this.charts.postCount.destroy();
                        this.charts.postCount = null;
                    }
                    if (this.charts.terTimeline) {
                        this.charts.terTimeline.destroy();
                        this.charts.terTimeline = null;
                    }

                    // Wait for next tick to ensure charts are fully destroyed
                    this.$nextTick(() => {
                        // Recreate canvas elements by replacing them
                        const postCountContainer = document.getElementById('postCountChart')?.parentElement;
                        const terTimelineContainer = document.getElementById('terTimelineChart')?.parentElement;

                        if (postCountContainer) {
                            const oldCanvas = document.getElementById('postCountChart');
                            if (oldCanvas) {
                                const newCanvas = document.createElement('canvas');
                                newCanvas.id = 'postCountChart';
                                postCountContainer.replaceChild(newCanvas, oldCanvas);
                            }
                        }

                        if (terTimelineContainer) {
                            const oldCanvas = document.getElementById('terTimelineChart');
                            if (oldCanvas) {
                                const newCanvas = document.createElement('canvas');
                                newCanvas.id = 'terTimelineChart';
                                terTimelineContainer.replaceChild(newCanvas, oldCanvas);
                            }
                        }

                        // Use another nextTick to ensure DOM updates are complete
                        this.$nextTick(() => {
                            // Post Count Chart
                            const postCanvas = document.getElementById('postCountChart');
                            if (postCanvas) {
                                this.charts.postCount = new Chart(postCanvas, {
                                    type: 'bar',
                                    data: {
                                        labels: labels,
                                        datasets: [{
                                            label: 'Anzahl Posts',
                                            data: postCounts,
                                            backgroundColor: 'rgba(59, 130, 246, 0.7)',
                                            borderColor: 'rgba(59, 130, 246, 1)',
                                            borderWidth: 2,
                                            borderRadius: 6
                                        }]
                                    },
                                    options: {
                                        responsive: true,
                                        maintainAspectRatio: true,
                                        plugins: {
                                            legend: {
                                                display: false
                                            },
                                            tooltip: {
                                                callbacks: {
                                                    label: function(context) {
                                                        return 'Posts: ' + context.parsed.y;
                                                    }
                                                }
                                            }
                                        },
                                        scales: {
                                            y: {
                                                beginAtZero: true,
                                                ticks: {
                                                    precision: 0
                                                }
                                            }
                                        }
                                    }
                                });
                        } else {
                            console.error('Canvas element postCountChart not found');
                        }

                        // TER Timeline Chart
                        const terCanvas = document.getElementById('terTimelineChart');
                        if (terCanvas) {
                            this.charts.terTimeline = new Chart(terCanvas, {
                                    type: 'line',
                                    data: {
                                        labels: labels,
                                        datasets: [{
                                            label: '√ò TER (Manuell)',
                                            data: avgTers,
                                            backgroundColor: 'rgba(168, 85, 247, 0.1)',
                                            borderColor: 'rgba(168, 85, 247, 1)',
                                            borderWidth: 3,
                                            fill: true,
                                            tension: 0.4,
                                            pointBackgroundColor: 'rgba(168, 85, 247, 1)',
                                            pointBorderColor: '#fff',
                                            pointBorderWidth: 2,
                                            pointRadius: 5,
                                            pointHoverRadius: 7
                                        }]
                                    },
                                    options: {
                                        responsive: true,
                                        maintainAspectRatio: true,
                                        plugins: {
                                            legend: {
                                                display: false
                                            },
                                            tooltip: {
                                                callbacks: {
                                                    label: function(context) {
                                                        return '√ò TER: ' + context.parsed.y.toFixed(2) + '%';
                                                    }
                                                }
                                            }
                                        },
                                        scales: {
                                            y: {
                                                beginAtZero: true,
                                                ticks: {
                                                    callback: function(value) {
                                                        return value + '%';
                                                    }
                                                }
                                            }
                                        }
                                    }
                                });
                            } else {
                                console.error('Canvas element terTimelineChart not found');
                            }
                        });
                    });
                },

                // File Upload
                handleFileSelect(event) {
                    this.selectedFile = event.target.files[0];
                    this.uploadResult = null;
                },

                handleFileDrop(event) {
                    this.dragOver = false;
                    this.selectedFile = event.dataTransfer.files[0];
                    this.uploadResult = null;
                },

                async uploadFile() {
                    if (!this.selectedFile) return;

                    this.uploading = true;
                    this.uploadResult = null;

                    const formData = new FormData();
                    formData.append('file', this.selectedFile);

                    try {
                        const response = await fetch('/api/upload', {
                            method: 'POST',
                            body: formData
                        });

                        const data = await response.json();

                        if (response.ok) {
                            this.uploadResult = data;
                            this.selectedFile = null;

                            // Reload data
                            await this.loadStats();
                            await this.loadPosts();
                            await this.loadAllPosts();
                            await this.loadStatistics();
                            await this.loadAvailableHandles();
                            await this.loadAvailableFactcheckers();

                            // Switch to review tab
                            setTimeout(() => {
                                this.currentTab = 'review';
                            }, 2000);
                        } else {
                            this.uploadResult = {
                                success: false,
                                error: data.error || 'Upload fehlgeschlagen'
                            };
                        }
                    } catch (error) {
                        console.error('Upload error:', error);
                        this.uploadResult = {
                            success: false,
                            error: 'Netzwerkfehler: ' + error.message
                        };
                    } finally {
                        this.uploading = false;
                    }
                },

                async handleTriggersFramesUpload(event) {
                    const file = event.target.files[0];
                    if (!file) return;

                    // Reset status
                    this.triggersFramesUploadStatus = {
                        message: '',
                        success: false,
                        matched: null,
                        not_matched: null
                    };

                    const formData = new FormData();
                    formData.append('file', file);

                    try {
                        const response = await fetch('/api/upload-triggers-frames', {
                            method: 'POST',
                            body: formData
                        });

                        const data = await response.json();

                        if (data.success) {
                            this.triggersFramesUploadStatus = {
                                message: data.message,
                                success: true,
                                matched: data.matched,
                                not_matched: data.not_matched
                            };

                            // Reload posts after successful import
                            await this.loadPosts();
                        } else {
                            this.triggersFramesUploadStatus = {
                                message: data.error || 'Import fehlgeschlagen',
                                success: false,
                                matched: null,
                                not_matched: null
                            };
                        }
                    } catch (error) {
                        this.triggersFramesUploadStatus = {
                            message: 'Fehler beim Upload: ' + error.message,
                            success: false,
                            matched: null,
                            not_matched: null
                        };
                    }

                    // Reset file input
                    event.target.value = '';
                },

                // Post Actions
                async updateManualTER(postId, value) {
                    const terValue = value && value !== '' ? parseFloat(value) : null;

                    try {
                        const response = await fetch(`/api/posts/${postId}`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ ter_manual: terValue })
                        });

                        if (response.ok) {
                            const updatedPost = await response.json();
                            const index = this.posts.findIndex(p => p.id === postId);
                            if (index !== -1) {
                                this.posts[index] = updatedPost;
                            }
                            await this.loadStatistics();
                        }
                    } catch (error) {
                        console.error('Error updating TER:', error);
                        this.showNotification('Fehler beim Speichern', 'error');
                    }
                },

                async updateNotes(postId, notes) {
                    try {
                        await fetch(`/api/posts/${postId}`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ notes })
                        });
                    } catch (error) {
                        console.error('Error updating notes:', error);
                    }
                },

                async updateTwitterDate(postId, date) {
                    try {
                        const response = await fetch(`/api/posts/${postId}`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ twitter_date: date })
                        });

                        if (response.ok) {
                            const updatedPost = await response.json();
                            const index = this.posts.findIndex(p => p.id === postId);
                            if (index !== -1) {
                                this.posts[index] = updatedPost;
                            }
                            console.log('Twitter-Datum aktualisiert:', date);
                        }
                    } catch (error) {
                        console.error('Error updating twitter date:', error);
                        this.showNotification('Fehler beim Speichern des Datums', 'error');
                    }
                },

                async updateAccessDate(postId, date) {
                    try {
                        const response = await fetch(`/api/posts/${postId}`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ access_date: date })
                        });

                        if (response.ok) {
                            const updatedPost = await response.json();
                            const index = this.posts.findIndex(p => p.id === postId);
                            if (index !== -1) {
                                this.posts[index] = updatedPost;
                            }
                            console.log('Zugriffsdatum aktualisiert:', date);
                        }
                    } catch (error) {
                        console.error('Error updating access date:', error);
                        this.showNotification('Fehler beim Speichern des Zugriffsdatums', 'error');
                    }
                },

                async toggleReviewed(postId, isReviewed) {
                    try {
                        const response = await fetch(`/api/posts/${postId}`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ is_reviewed: isReviewed })
                        });

                        if (response.ok) {
                            // Keep current pagination when toggling reviewed status
                            await this.loadPosts(true);
                            await this.loadStats();
                        }
                    } catch (error) {
                        console.error('Error toggling reviewed:', error);
                        this.showNotification('Fehler beim Speichern', 'error');
                    }
                },

                async toggleArchive(postId, isArchived) {
                    try {
                        const response = await fetch(`/api/posts/${postId}`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ is_archived: isArchived })
                        });

                        if (response.ok) {
                            // Keep current pagination when archiving/unarchiving
                            await this.loadPosts(true);
                            await this.loadStats();
                            await this.loadStatistics();
                            this.showNotification(
                                isArchived ? 'Post erfolgreich archiviert' : 'Post erfolgreich wiederhergestellt',
                                'success'
                            );
                        }
                    } catch (error) {
                        console.error('Error toggling archive:', error);
                        this.showNotification('Fehler beim Archivieren', 'error');
                    }
                },

                async toggleFavorite(postId, isFavorite) {
                    try {
                        const response = await fetch(`/api/posts/${postId}`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ is_favorite: isFavorite })
                        });

                        if (response.ok) {
                            // Keep current pagination when adding/removing favorites
                            await this.loadPosts(true);
                            await this.loadFavoritePosts();
                            this.showNotification(
                                isFavorite ? 'Post zu Favoriten hinzugef√ºgt ‚≠ê' : 'Post aus Favoriten entfernt',
                                'success'
                            );
                        }
                    } catch (error) {
                        console.error('Error toggling favorite:', error);
                        this.showNotification('Fehler beim Favorisieren', 'error');
                    }
                },

                async loadArchivedPosts() {
                    this.loadingArchived = true;

                    try {
                        const response = await fetch('/api/posts/archived?sort=created_at&order=desc');
                        const data = await response.json();

                        this.archivedPosts = (data.posts || []).map(post => ({
                            ...post,
                            showPreview: false  // Initialize preview state
                        }));

                        // Also reload statistics to update archive counter
                        await this.loadStatistics();
                    } catch (error) {
                        console.error('Error loading archived posts:', error);
                        this.showNotification('Fehler beim Laden der archivierten Posts', 'error');
                    } finally {
                        this.loadingArchived = false;
                    }
                },

                async loadFavoritePosts() {
                    this.loadingFavorites = true;

                    try {
                        const response = await fetch('/api/posts/favorites?sort=created_at&order=desc');
                        const data = await response.json();

                        this.favoritePosts = (data.posts || []).map(post => ({
                            ...post,
                            showPreview: false  // Initialize preview state
                        }));
                    } catch (error) {
                        console.error('Error loading favorite posts:', error);
                        this.showNotification('Fehler beim Laden der Favoriten', 'error');
                    } finally {
                        this.loadingFavorites = false;
                    }
                },

                async favoritePost(postId) {
                    try {
                        const response = await fetch(`/api/posts/${postId}`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ is_favorite: true })
                        });

                        if (response.ok) {
                            await this.loadFavoritePosts();
                            await this.loadPosts();
                            this.showNotification('Post zu Favoriten hinzugef√ºgt ‚≠ê', 'success');
                        }
                    } catch (error) {
                        console.error('Error favoriting post:', error);
                        this.showNotification('Fehler beim Hinzuf√ºgen zu Favoriten', 'error');
                    }
                },

                async unfavoritePost(postId) {
                    try {
                        const response = await fetch(`/api/posts/${postId}`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ is_favorite: false })
                        });

                        if (response.ok) {
                            await this.loadFavoritePosts();
                            await this.loadPosts();
                            this.showNotification('Post aus Favoriten entfernt', 'success');
                        }
                    } catch (error) {
                        console.error('Error unfavoriting post:', error);
                        this.showNotification('Fehler beim Entfernen aus Favoriten', 'error');
                    }
                },

                exportFavoritesCSV() {
                    if (this.favoritePosts.length === 0) {
                        this.showNotification('Keine Favoriten zum Exportieren vorhanden', 'warning');
                        return;
                    }

                    // √ñffne Export-URL in neuem Fenster/Tab - Browser startet automatischen Download
                    window.location.href = '/api/posts/favorites/export';
                    this.showNotification(`${this.favoritePosts.length} Favoriten werden exportiert...`, 'success');
                },

                async unarchivePost(postId) {
                    try {
                        const response = await fetch(`/api/posts/${postId}`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ is_archived: false })
                        });

                        if (response.ok) {
                            await this.loadArchivedPosts();
                            await this.loadPosts();
                            await this.loadStats();
                            await this.loadStatistics();
                            this.showNotification('Post erfolgreich wiederhergestellt', 'success');
                        }
                    } catch (error) {
                        console.error('Error unarchiving post:', error);
                        this.showNotification('Fehler beim Wiederherstellen', 'error');
                    }
                },

                async deletePost(postId) {
                    this.showConfirm('Post wirklich l√∂schen?', async () => {
                        try {
                            const response = await fetch(`/api/posts/${postId}`, {
                                method: 'DELETE'
                            });

                            if (response.ok) {
                                await this.loadPosts();
                                await this.loadStats();
                                await this.loadStatistics();

                                // If we're on the archive tab, also reload archived posts
                                if (this.currentTab === 'archive') {
                                    await this.loadArchivedPosts();
                                }

                                this.showNotification('Post erfolgreich gel√∂scht', 'success');
                            }
                        } catch (error) {
                            console.error('Error deleting post:', error);
                            this.showNotification('Fehler beim L√∂schen', 'error');
                        }
                    });
                },

                // Manual TER Calculator Functions
                openManualCalculator(postId, index) {
                    // Set active post
                    this.manualCalc.postId = postId;

                    // Find the post to get current values
                    const post = this.posts.find(p => p.id === postId);

                    // Prefill with existing manual values, or fall back to automatic values
                    if (post) {
                        this.manualCalc.values = {
                            views: post.views_manual !== null ? post.views_manual : post.views,
                            likes: post.likes_manual !== null ? post.likes_manual : post.likes,
                            bookmarks: post.bookmarks_manual !== null ? post.bookmarks_manual : post.bookmarks,
                            replies: post.replies_manual !== null ? post.replies_manual : post.replies,
                            retweets: post.retweets_manual !== null ? post.retweets_manual : post.retweets,
                            quotes: post.quotes_manual !== null ? post.quotes_manual : post.quotes
                        };
                    } else {
                        // Reset values if post not found
                        this.manualCalc.values = {
                            views: 0,
                            likes: 0,
                            bookmarks: 0,
                            replies: 0,
                            retweets: 0,
                            quotes: 0
                        };
                    }

                    // Calculate initial TER with prefilled values
                    this.calculateManualTER();

                    // Scroll to calculator
                    setTimeout(() => {
                        const element = document.querySelector('[x-show="manualCalc.postId === post.id"]');
                        if (element) {
                            element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                    }, 100);
                },

                closeManualCalculator() {
                    this.manualCalc.postId = null;
                },

                calculateManualTER() {
                    // Hirsch 2025 Gewichtung
                    const weights = {
                        likes: 1,
                        bookmarks: 2,
                        replies: 3,
                        retweets: 4,
                        quotes: 5
                    };

                    // Weighted Engagement berechnen
                    const weighted = (
                        (this.manualCalc.values.likes * weights.likes) +
                        (this.manualCalc.values.bookmarks * weights.bookmarks) +
                        (this.manualCalc.values.replies * weights.replies) +
                        (this.manualCalc.values.retweets * weights.retweets) +
                        (this.manualCalc.values.quotes * weights.quotes)
                    );

                    // Total Interactions (ungewichtet)
                    const total = (
                        this.manualCalc.values.likes +
                        this.manualCalc.values.bookmarks +
                        this.manualCalc.values.replies +
                        this.manualCalc.values.retweets +
                        this.manualCalc.values.quotes
                    );

                    // TER berechnen - NEUE FORMEL (Hirsch 2025)
                    let terSqrt = 0;
                    let terLinear = 0;
                    let engagementLevel = '';
                    let engagementLevelCode = '';

                    if (this.manualCalc.values.views > 0) {
                        // TER‚àö (neue Formel mit ‚àöViews-Normalisierung)
                        terSqrt = weighted / Math.sqrt(this.manualCalc.values.views);
                        // TER linear (alte Formel zur Vergleichbarkeit)
                        terLinear = (weighted / this.manualCalc.values.views) * 100;

                        // Engagement Level klassifizieren
                        if (terSqrt < 5) {
                            engagementLevel = 'Niedriges Engagement (passive Rezeption)';
                            engagementLevelCode = 'low';
                        } else if (terSqrt < 10) {
                            engagementLevel = 'Mittleres Engagement (moderate Aktivierung)';
                            engagementLevelCode = 'medium';
                        } else if (terSqrt < 15) {
                            engagementLevel = 'Hohes Engagement (starke emotionale Involvierung)';
                            engagementLevelCode = 'high';
                        } else {
                            engagementLevel = 'Sehr hohes Engagement (virale Aktivierung)';
                            engagementLevelCode = 'very_high';
                        }
                    }

                    // Ergebnis speichern
                    this.manualCalc.result = {
                        ter: terSqrt,  // Hauptwert ist jetzt TER‚àö
                        ter_sqrt: terSqrt,
                        ter_linear: terLinear,
                        weighted_engagement: weighted,
                        total_interactions: total,
                        engagement_level: engagementLevel,
                        engagement_level_code: engagementLevelCode
                    };
                },

                prefillFromPost(post) {
                    // Werte vom Post √ºbernehmen
                    this.manualCalc.values = {
                        views: post.views || 0,
                        likes: post.likes || 0,
                        bookmarks: post.bookmarks || 0,
                        replies: post.replies || 0,
                        retweets: post.retweets || 0,
                        quotes: post.quotes || 0
                    };

                    // Neu berechnen
                    this.calculateManualTER();
                },

                async saveManualTER(postId) {
                    const ter = this.manualCalc.result.ter;

                    // Callback f√ºr das eigentliche Speichern
                    const doSave = async () => {
                        try {
                            // Prepare data with TER and manual engagement metrics
                            const data = {
                            ter_manual: ter,
                            views_manual: this.manualCalc.values.views || null,
                            likes_manual: this.manualCalc.values.likes || null,
                            bookmarks_manual: this.manualCalc.values.bookmarks || null,
                            replies_manual: this.manualCalc.values.replies || null,
                            retweets_manual: this.manualCalc.values.retweets || null,
                            quotes_manual: this.manualCalc.values.quotes || null
                        };

                        const response = await fetch(`/api/posts/${postId}`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(data)
                        });

                        if (response.ok) {
                            const updatedPost = await response.json();
                            const index = this.posts.findIndex(p => p.id === postId);
                            if (index !== -1) {
                                this.posts[index] = updatedPost;
                            }
                            await this.loadStatistics();

                            // Success feedback
                            this.showNotification(`TER ${ter.toFixed(2)}% und manuelle Engagement-Metriken erfolgreich gespeichert!`, 'success');

                            // Close calculator
                            this.closeManualCalculator();
                        } else {
                            this.showNotification('Fehler beim Speichern', 'error');
                        }
                        } catch (error) {
                            console.error('Error saving manual TER:', error);
                            this.showNotification('Fehler beim Speichern: ' + error.message, 'error');
                        }
                    };

                    // Check if TER is 0 and ask for confirmation
                    if (ter === 0) {
                        this.showConfirm('TER ist 0%. Trotzdem speichern?', doSave);
                    } else {
                        await doSave();
                    }
                },

                async saveEngagementMetrics(postId, engagement) {
                    try {
                        // Wichtig: 0 ist ein g√ºltiger Wert und muss gespeichert werden!
                        const data = {
                            views_manual: engagement.views !== undefined && engagement.views !== null ? engagement.views : null,
                            likes_manual: engagement.likes !== undefined && engagement.likes !== null ? engagement.likes : null,
                            bookmarks_manual: engagement.bookmarks !== undefined && engagement.bookmarks !== null ? engagement.bookmarks : null,
                            replies_manual: engagement.replies !== undefined && engagement.replies !== null ? engagement.replies : null,
                            retweets_manual: engagement.retweets !== undefined && engagement.retweets !== null ? engagement.retweets : null,
                            quotes_manual: engagement.quotes !== undefined && engagement.quotes !== null ? engagement.quotes : null
                        };

                        const response = await fetch(`/api/posts/${postId}`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(data)
                        });

                        if (response.ok) {
                            const updatedPost = await response.json();
                            const index = this.posts.findIndex(p => p.id === postId);
                            if (index !== -1) {
                                this.posts[index] = updatedPost;
                            }
                            await this.loadStatistics();

                            this.showNotification('Engagement-Metriken erfolgreich gespeichert!', 'success');
                        } else {
                            this.showNotification('Fehler beim Speichern', 'error');
                        }
                    } catch (error) {
                        console.error('Error saving engagement metrics:', error);
                        this.showNotification('Fehler beim Speichern: ' + error.message, 'error');
                    }
                },

                // Trigger & Frame Functions
                async saveTriggerFrame(postId, post) {
                    try {
                        const data = {
                            trigger_angst: post.trigger_angst || 0,
                            trigger_wut: post.trigger_wut || 0,
                            trigger_empoerung: post.trigger_empoerung || 0,
                            trigger_ekel: post.trigger_ekel || 0,
                            trigger_identitaet: post.trigger_identitaet || 0,
                            trigger_hoffnung: post.trigger_hoffnung || 0,
                            frame_opfer_taeter: post.frame_opfer_taeter || 0,
                            frame_bedrohung: post.frame_bedrohung || 0,
                            frame_verschwoerung: post.frame_verschwoerung || 0,
                            frame_moral: post.frame_moral || 0,
                            frame_historisch: post.frame_historisch || 0
                        };

                        // Validation: Trigger values must be 0-5
                        const triggerValues = [
                            data.trigger_angst,
                            data.trigger_wut,
                            data.trigger_empoerung,
                            data.trigger_ekel,
                            data.trigger_identitaet,
                            data.trigger_hoffnung
                        ];

                        for (let i = 0; i < triggerValues.length; i++) {
                            const value = triggerValues[i];
                            if (value < 0 || value > 5) {
                                this.showNotification('‚ùå Trigger-Werte m√ºssen zwischen 0 und 5 liegen!', 'error');
                                return;
                            }
                        }

                        // Frame-Validierung ist nicht n√∂tig, da Checkboxen nur 0 oder 1 liefern k√∂nnen

                        const response = await fetch(`/api/posts/${postId}`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(data)
                        });

                        if (response.ok) {
                            const updatedPost = await response.json();
                            const index = this.posts.findIndex(p => p.id === postId);
                            if (index !== -1) {
                                this.posts[index] = updatedPost;
                            }
                            this.showNotification('Trigger & Frames erfolgreich gespeichert!', 'success');
                        } else {
                            this.showNotification('Fehler beim Speichern', 'error');
                        }
                    } catch (error) {
                        console.error('Error saving trigger/frame:', error);
                        this.showNotification('Fehler beim Speichern: ' + error.message, 'error');
                    }
                },

                // Reviewed Posts Functions
                sortReviewedPosts() {
                    const sorted = [...this.reviewedPosts];

                    switch(this.reviewedSort) {
                        case 'ter_manual_desc':
                            sorted.sort((a, b) => (b.ter_manual || 0) - (a.ter_manual || 0));
                            break;
                        case 'ter_manual_asc':
                            sorted.sort((a, b) => (a.ter_manual || 0) - (b.ter_manual || 0));
                            break;
                        case 'date_desc':
                            sorted.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
                            break;
                        case 'views_desc':
                            sorted.sort((a, b) => b.views - a.views);
                            break;
                        case 'followers_desc':
                            sorted.sort((a, b) => b.twitter_followers - a.twitter_followers);
                            break;
                    }

                    // Update posts array in place
                    const reviewedIds = sorted.map(p => p.id);
                    this.posts = [
                        ...sorted,
                        ...this.posts.filter(p => !p.is_reviewed)
                    ];
                },

                reviewedPostsWithManualTER() {
                    return this.reviewedPosts.filter(p => p.ter_manual !== null && p.ter_manual !== undefined);
                },

                calculateAvgAutoTER() {
                    if (this.reviewedPosts.length === 0) return 0;
                    const sum = this.reviewedPosts.reduce((acc, p) => acc + p.ter_automatic, 0);
                    return (sum / this.reviewedPosts.length).toFixed(2);
                },

                calculateAvgManualTER() {
                    const postsWithManual = this.reviewedPostsWithManualTER();
                    if (postsWithManual.length === 0) return 0;
                    const sum = postsWithManual.reduce((acc, p) => acc + p.ter_manual, 0);
                    return (sum / postsWithManual.length).toFixed(2);
                },

                calculateAvgDifference() {
                    const postsWithManual = this.reviewedPostsWithManualTER();
                    if (postsWithManual.length === 0) return 0;
                    const sum = postsWithManual.reduce((acc, p) => acc + (p.ter_manual - p.ter_automatic), 0);
                    return (sum / postsWithManual.length).toFixed(2);
                },

                calculateTotalViews() {
                    return this.reviewedPosts.reduce((acc, p) => acc + p.views, 0);
                },

                calculateAvgFollowers() {
                    if (this.reviewedPosts.length === 0) return 0;
                    const sum = this.reviewedPosts.reduce((acc, p) => acc + p.twitter_followers, 0);
                    return Math.round(sum / this.reviewedPosts.length);
                },

                calculateTotalInteractions() {
                    return this.reviewedPosts.reduce((acc, p) => acc + p.total_interactions, 0);
                },

                viewPostDetails(post) {
                    // Switch to review tab and scroll to post
                    this.currentTab = 'review';
                    setTimeout(() => {
                        const postCard = document.querySelector(`[data-post-id="${post.id}"]`);
                        if (postCard) {
                            postCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                    }, 100);
                },

                async exportReviewedPostsPDF() {
                    try {
                        this.showNotification('PDF wird erstellt...', 'info');

                        const response = await fetch('/api/posts/reviewed/export-pdf');

                        if (!response.ok) {
                            const error = await response.json();
                            throw new Error(error.error || 'Export fehlgeschlagen');
                        }

                        // PDF als Blob herunterladen
                        const blob = await response.blob();
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `reviewed_posts_export_${new Date().toISOString().slice(0,10)}.pdf`;
                        document.body.appendChild(a);
                        a.click();
                        window.URL.revokeObjectURL(url);
                        document.body.removeChild(a);

                        this.showNotification(`PDF erfolgreich erstellt! (${this.reviewedPosts.length} Posts)`, 'success');
                    } catch (error) {
                        console.error('PDF Export Error:', error);
                        this.showNotification('PDF-Export fehlgeschlagen: ' + error.message, 'error');
                    }
                },

                async exportReviewedPostsExcel() {
                    try {
                        this.showNotification('Excel-Datei wird erstellt...', 'info');

                        const response = await fetch('/api/posts/reviewed/export-excel');

                        if (!response.ok) {
                            const error = await response.json();
                            throw new Error(error.error || 'Export fehlgeschlagen');
                        }

                        // Excel als Blob herunterladen
                        const blob = await response.blob();
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `reviewed_posts_export_${new Date().toISOString().slice(0,10)}.xlsx`;
                        document.body.appendChild(a);
                        a.click();
                        window.URL.revokeObjectURL(url);
                        document.body.removeChild(a);

                        this.showNotification(`Excel erfolgreich erstellt! (${this.reviewedPosts.length} Posts)`, 'success');
                    } catch (error) {
                        console.error('Excel Export Error:', error);
                        this.showNotification('Excel-Export fehlgeschlagen: ' + error.message, 'error');
                    }
                },

                async exportReviewedPostsCSV() {
                    try {
                        this.showNotification('CSV-Datei wird erstellt...', 'info');

                        const response = await fetch('/api/posts/reviewed/export-csv');

                        if (!response.ok) {
                            const error = await response.json();
                            throw new Error(error.error || 'Export fehlgeschlagen');
                        }

                        // CSV als Blob herunterladen
                        const blob = await response.blob();
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `reviewed_posts_export_${new Date().toISOString().slice(0,10)}.csv`;
                        document.body.appendChild(a);
                        a.click();
                        window.URL.revokeObjectURL(url);
                        document.body.removeChild(a);

                        this.showNotification(`CSV erfolgreich erstellt! (${this.reviewedPosts.length} Posts)`, 'success');
                    } catch (error) {
                        console.error('CSV Export Error:', error);
                        this.showNotification('CSV-Export fehlgeschlagen: ' + error.message, 'error');
                    }
                },

                // Pagination Functions
                nextPage() {
                    if (this.pagination.currentPage < this.totalPages) {
                        this.pagination.currentPage++;
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }
                },

                prevPage() {
                    if (this.pagination.currentPage > 1) {
                        this.pagination.currentPage--;
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }
                },

                goToPage(page) {
                    if (page >= 1 && page <= this.totalPages) {
                        this.pagination.currentPage = page;
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }
                },

                resetPagination() {
                    this.pagination.currentPage = 1;
                },

                // ===== SESSION MANAGEMENT =====

                async loadSessions() {
                    try {
                        const response = await fetch('/api/sessions');
                        const data = await response.json();
                        this.sessions = data.sessions || [];
                    } catch (error) {
                        console.error('Fehler beim Laden der Sessions:', error);
                        this.showNotification('Fehler beim Laden der Sessions', 'error');
                    }
                },

                async loadActiveSession() {
                    try {
                        const response = await fetch('/api/sessions/active');
                        const data = await response.json();
                        this.activeSession = data.session || null;
                    } catch (error) {
                        console.error('Fehler beim Laden der aktiven Session:', error);
                    }
                },

                async switchSession(sessionId) {
                    try {
                        this.loading = true;
                        const response = await fetch(`/api/sessions/${sessionId}/activate`, {
                            method: 'POST'
                        });

                        if (response.ok) {
                            await this.loadActiveSession();
                            await this.loadStats();
                            await this.loadPosts();
                            await this.loadAllPosts();
                            await this.loadStatistics();
                            await this.loadTimelineData();
                            this.showNotification('Session gewechselt', 'success');
                        } else {
                            throw new Error('Fehler beim Wechseln der Session');
                        }
                    } catch (error) {
                        console.error('Fehler beim Wechseln der Session:', error);
                        this.showNotification('Fehler beim Wechseln der Session', 'error');
                    } finally {
                        this.loading = false;
                    }
                },

                openSessionDialog(mode = 'create') {
                    this.sessionDialog.mode = mode;
                    this.sessionDialog.show = true;
                    this.sessionDialog.newSession = { name: '', description: '' };
                },

                closeSessionDialog() {
                    this.sessionDialog.show = false;
                    this.sessionDialog.newSession = { name: '', description: '' };
                },

                async createSession() {
                    if (!this.sessionDialog.newSession.name.trim()) {
                        this.showNotification('Bitte gib einen Namen ein', 'error');
                        return;
                    }

                    try {
                        this.loading = true;
                        const response = await fetch('/api/sessions', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.sessionDialog.newSession)
                        });

                        if (response.ok) {
                            await this.loadSessions();
                            const data = await response.json();
                            this.showNotification(`Session "${data.session.name}" erstellt`, 'success');
                            this.closeSessionDialog();

                            // Automatisch zur neuen Session wechseln
                            await this.switchSession(data.session.id);
                        } else {
                            const error = await response.json();
                            throw new Error(error.error || 'Fehler beim Erstellen der Session');
                        }
                    } catch (error) {
                        console.error('Fehler beim Erstellen der Session:', error);
                        this.showNotification(error.message, 'error');
                    } finally {
                        this.loading = false;
                    }
                },

                async deleteSession(sessionId, sessionName) {
                    this.showConfirmDialog(
                        `M√∂chtest du die Session "${sessionName}" wirklich l√∂schen? Alle Posts dieser Session werden ebenfalls gel√∂scht!`,
                        async () => {
                            try {
                                this.loading = true;
                                const response = await fetch(`/api/sessions/${sessionId}`, {
                                    method: 'DELETE'
                                });

                                if (response.ok) {
                                    await this.loadSessions();

                                    // Wenn die gel√∂schte Session aktiv war, neu laden
                                    if (this.activeSession && this.activeSession.id === sessionId) {
                                        await this.loadActiveSession();
                                        await this.loadStats();
                                        await this.loadPosts();
                                        await this.loadAllPosts();
                                        await this.loadStatistics();
                                        await this.loadTimelineData();
                                    }

                                    this.showNotification('Session gel√∂scht', 'success');
                                } else {
                                    throw new Error('Fehler beim L√∂schen der Session');
                                }
                            } catch (error) {
                                console.error('Fehler beim L√∂schen der Session:', error);
                                this.showNotification('Fehler beim L√∂schen der Session', 'error');
                            } finally {
                                this.loading = false;
                            }
                        }
                    );
                },

                // Utilities
                openTwitterUrl(url) {
                    window.open(url, '_blank');
                }
            }
        }
    </script>

</body>
</html>
